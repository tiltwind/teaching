<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小学英语学习助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#EC4899',
                        accent: '#10B981',
                        neutral: '#1F2937',
                        'neutral-light': '#F3F4F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-flip {
                perspective: 1000px;
                transform-style: preserve-3d;
            }
            .card-front, .card-back {
                backface-visibility: hidden;
                transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .card-back {
                transform: rotateY(180deg);
            }
            .card-flipped .card-front {
                transform: rotateY(180deg);
            }
            .card-flipped .card-back {
                transform: rotateY(0deg);
            }
            .progress-animation {
                transition: width 1s ease-in-out;
            }
            .slide-in {
                animation: slideIn 0.5s ease-out forwards;
            }
            @keyframes slideIn {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            .pulse {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen font-sans">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-md fixed w-full z-50 transition-all duration-300" id="mainNav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="#" class="flex-shrink-0 flex items-center">
                        <i class="fa fa-graduation-cap text-primary text-2xl mr-2"></i>
                        <span class="text-xl font-bold text-neutral">小学英语学习助手</span>
                    </a>
                    <div class="hidden sm:ml-6 sm:flex space-x-8">
                        <a href="#vocabulary" class="border-primary text-primary border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-book mr-1"></i> 单词学习
                        </a>
                        <a href="#grammar" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-code-fork mr-1"></i> 语法学习
                        </a>
                        <a href="#test" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-check-square-o mr-1"></i> 知识测试
                        </a>
                        <a href="#stats" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-bar-chart mr-1"></i> 学习统计
                        </a>
                    </div>
                </div>
                <div class="flex items-center">
                    <button id="themeToggle" class="p-2 rounded-full text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                        <i class="fa fa-moon-o"></i>
                    </button>
                    <button type="button" class="ml-4 p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none sm:hidden" id="mobileMenuButton">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- 移动端菜单 -->
        <div class="sm:hidden hidden" id="mobileMenu">
            <div class="px-2 pt-2 pb-3 space-y-1 bg-white shadow-lg">
                <a href="#vocabulary" class="bg-primary/10 text-primary block pl-3 pr-4 py-2 border-l-4 border-primary text-base font-medium">
                    <i class="fa fa-book mr-1"></i> 单词学习
                </a>
                <a href="#grammar" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-code-fork mr-1"></i> 语法学习
                </a>
                <a href="#test" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-check-square-o mr-1"></i> 知识测试
                </a>
                <a href="#stats" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-bar-chart mr-1"></i> 学习统计
                </a>
            </div>
        </div>
    </nav>

    <!-- 英雄区域 -->
    <header class="pt-24 pb-12 md:pt-32 md:pb-20 bg-gradient-to-r from-primary to-secondary text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold leading-tight mb-4">
                    小学英语学习助手
                </h1>
                <p class="text-[clamp(1rem,2vw,1.25rem)] text-white/80 max-w-3xl mx-auto mb-8">
                    轻松掌握人教版小学五年级英语知识点，通过互动学习和测试巩固记忆
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#vocabulary" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-accent hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition-all duration-300 transform hover:scale-105">
                        <i class="fa fa-book mr-2"></i> 开始学习
                    </a>
                    <a href="#test" class="inline-flex items-center justify-center px-6 py-3 border border-white text-base font-medium rounded-md text-white bg-transparent hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white transition-all duration-300 transform hover:scale-105">
                        <i class="fa fa-check-square-o mr-2"></i> 立即测试
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- 单词学习部分 -->
        <section id="vocabulary" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-book text-primary mr-2"></i> 单词学习
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    掌握五年级英语核心单词，通过卡片学习法加深记忆
                </p>
            </div>

            <!-- 单词筛选和控制 -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h3 class="text-lg font-semibold text-neutral mb-2">筛选单词</h3>
                        <div class="flex flex-wrap gap-2">
                            <button class="vocab-filter-btn px-4 py-2 rounded-full bg-primary text-white text-sm font-medium" data-filter="all">全部</button>
                            <button class="vocab-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="上册">上册</button>
                            <button class="vocab-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="下册">下册</button>
                            <button class="vocab-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="动物">动物</button>
                            <button class="vocab-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="食物">食物</button>
                            <button class="vocab-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="数字">数字</button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button id="vocabShuffle" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-random mr-2"></i> 随机排序
                        </button>
                        <button id="vocabReset" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-refresh mr-2"></i> 重置
                        </button>
                    </div>
                </div>
            </div>

            <!-- 单词卡片网格 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="vocabularyCards">
                <!-- 单词卡片将通过JavaScript动态生成 -->
            </div>
        </section>

        <!-- 语法学习部分 -->
        <section id="grammar" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-code-fork text-primary mr-2"></i> 语法学习
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    系统学习五年级英语语法知识，打下坚实基础
                </p>
            </div>

            <!-- 语法筛选和控制 -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h3 class="text-lg font-semibold text-neutral mb-2">筛选语法</h3>
                        <div class="flex flex-wrap gap-2">
                            <button class="grammar-filter-btn px-4 py-2 rounded-full bg-primary text-white text-sm font-medium" data-filter="all">全部</button>
                            <button class="grammar-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="上册">上册</button>
                            <button class="grammar-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="下册">下册</button>
                            <button class="grammar-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="时态">时态</button>
                            <button class="grammar-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="句型">句型</button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button id="grammarShuffle" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-random mr-2"></i> 随机排序
                        </button>
                        <button id="grammarReset" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-refresh mr-2"></i> 重置
                        </button>
                    </div>
                </div>
            </div>

            <!-- 语法卡片网格 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="grammarCards">
                <!-- 语法卡片将通过JavaScript动态生成 -->
            </div>
        </section>

        <!-- 测试部分 -->
        <section id="test" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-check-square-o text-primary mr-2"></i> 知识测试
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    通过测试检验学习成果，随机出题，包含选择题和填空题
                </p>
            </div>

            <!-- 测试设置 -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6 max-w-3xl mx-auto">
                <h3 class="text-lg font-semibold text-neutral mb-4">测试设置</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="testType" class="block text-sm font-medium text-gray-700 mb-1">测试类型</label>
                        <select id="testType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/20 focus:ring-opacity-50">
                            <option value="mixed">混合测试（单词+语法）</option>
                            <option value="vocabulary">单词测试</option>
                            <option value="grammar">语法测试</option>
                        </select>
                    </div>
                    <div>
                        <label for="questionCount" class="block text-sm font-medium text-gray-700 mb-1">题目数量</label>
                        <select id="questionCount" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/20 focus:ring-opacity-50">
                            <option value="5">5题</option>
                            <option value="10" selected>10题</option>
                            <option value="15">15题</option>
                            <option value="20">20题</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6">
                    <button id="startTest" class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-300 transform hover:scale-[1.02]">
                        <i class="fa fa-play-circle mr-2"></i> 开始测试
                    </button>
                </div>
            </div>

            <!-- 测试区域 (默认隐藏) -->
            <div id="testArea" class="hidden max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-neutral" id="testTitle">单词测试</h3>
                        <div class="flex items-center">
                            <span class="text-sm text-gray-500 mr-2">进度:</span>
                            <div class="w-32 bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full progress-animation" id="testProgressBar" style="width: 0%"></div>
                            </div>
                            <span class="ml-2 text-sm font-medium" id="testProgressText">0/10</span>
                        </div>
                    </div>

                    <div id="questionContainer" class="mb-8">
                        <!-- 题目内容将通过JavaScript动态生成 -->
                    </div>

                    <div id="answerFeedback" class="mb-6 hidden">
                        <div id="correctFeedback" class="hidden bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded relative">
                            <strong class="font-bold">正确!</strong>
                            <span class="block sm:inline" id="correctAnswerText"></span>
                        </div>
                        <div id="incorrectFeedback" class="hidden bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative">
                            <strong class="font-bold">错误!</strong>
                            <span class="block sm:inline" id="incorrectAnswerText"></span>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button id="prevQuestion" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-arrow-left mr-1"></i> 上一题
                        </button>
                        <button id="nextQuestion" class="px-4 py-2 border border-transparent rounded-md text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            下一题 <i class="fa fa-arrow-right mr-1"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 测试结果 (默认隐藏) -->
            <div id="testResults" class="hidden max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-md p-8 text-center">
                    <div class="mb-6">
                        <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-green-100 text-green-600 mb-4">
                            <i class="fa fa-trophy text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-neutral mb-2">测试完成!</h3>
                        <p class="text-gray-600 mb-4">你的得分已保存到本地</p>
                        <div class="text-4xl font-bold text-primary mb-6" id="finalScore">0/10</div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-medium text-neutral mb-3">历史得分</h4>
                        <div id="scoreHistory" class="grid grid-cols-2 sm:grid-cols-5 gap-2 max-w-lg mx-auto">
                            <!-- 历史得分将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button id="reviewAnswers" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <i class="fa fa-book mr-1"></i> 查看错题
                        </button>
                        <button id="retakeTest" class="px-6 py-3 border border-transparent rounded-md text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <i class="fa fa-refresh mr-1"></i> 再测一次
                        </button>
                    </div>
                </div>
                
                <!-- 错题回顾区域 -->
                <div id="wrongAnswersReview" class="hidden mt-6 bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium text-neutral">
                            <i class="fa fa-exclamation-triangle text-orange-500 mr-2"></i>
                            错题回顾与解析
                        </h4>
                        <button id="closeReview" class="text-gray-400 hover:text-gray-600">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div id="wrongAnswersList" class="space-y-4">
                        <!-- 错题列表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 统计部分 -->
        <section id="stats" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-bar-chart text-primary mr-2"></i> 学习统计
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    查看你的学习进度和成绩统计，激励自己不断进步
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <!-- 学习进度卡片 -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-neutral mb-4">学习进度</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">单词学习</span>
                                <span id="vocabProgressText">0/0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full progress-animation" id="vocabProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">语法学习</span>
                                <span id="grammarProgressText">0/0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-secondary h-2.5 rounded-full progress-animation" id="grammarProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">测试完成率</span>
                                <span id="testProgressText">0/0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-accent h-2.5 rounded-full progress-animation" id="testProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 测试成绩卡片 -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-neutral mb-4">测试成绩</h3>
                    <div id="scoreChart" class="h-64">
                        <!-- Chart.js 图表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 学习建议 -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold text-neutral mb-4">学习建议</h3>
                <div id="learningTips" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- 学习建议将通过JavaScript动态生成 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-neutral text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">小学英语学习助手</h3>
                    <p class="text-gray-400 mb-4">
                        帮助小学生轻松掌握英语知识，提高学习效率和成绩
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-youtube"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">学习资源</h4>
                    <ul class="space-y-2">
                        <li><a href="#vocabulary" class="text-gray-400 hover:text-white transition-colors">单词学习</a></li>
                        <li><a href="#grammar" class="text-gray-400 hover:text-white transition-colors">语法学习</a></li>
                        <li><a href="#test" class="text-gray-400 hover:text-white transition-colors">知识测试</a></li>
                        <li><a href="#stats" class="text-gray-400 hover:text-white transition-colors">学习统计</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">关于我们</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">使用指南</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">常见问题</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">联系我们</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">隐私政策</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">订阅更新</h4>
                    <p class="text-gray-400 mb-4">
                        获取最新学习资料和教育资讯
                    </p>
                    <form class="space-y-2">
                        <div>
                            <input type="email" placeholder="输入你的邮箱" class="w-full px-4 py-2 rounded-md bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <button type="submit" class="w-full px-4 py-2 bg-primary hover:bg-primary/90 rounded-md text-white font-medium transition-colors">
                            订阅
                        </button>
                    </form>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2025 小学英语学习助手. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- 返回顶部按钮 -->
    <button id="backToTop" class="fixed bottom-6 right-6 bg-primary text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
        <i class="fa fa-arrow-up"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="vocabulary.js"></script>
    <script src="grammar.js"></script>
    <script>
        // 学习数据
        const learningData = {
            vocabulary: window.vocabulary,
            grammar: window.grammar,
            tests: JSON.parse(localStorage.getItem('englishLearningTests')) || []
        };

        // 测试数据
        const testData = {
            currentTest: null,
            currentQuestionIndex: 0,
            userAnswers: [],
            questions: []
        };

        // DOM加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化单词卡片
            renderVocabularyCards();
            
            // 初始化语法卡片
            renderGrammarCards();
            
            // 初始化测试历史
            renderTestHistory();
            
            // 初始化学习统计
            initLearningStats();
            
            // 初始化导航栏滚动效果
            initScrollEffects();
            
            // 初始化移动端菜单
            initMobileMenu();
            
            // 初始化测试功能
            initTestFunctionality();
            
            // 初始化主题切换
            initThemeToggle();
            
            // 初始化返回顶部按钮
            initBackToTopButton();
        });

        // 渲染单词卡片
        function renderVocabularyCards(filter = 'all') {
            const container = document.getElementById('vocabularyCards');
            container.innerHTML = '';
            
            const filteredVocabulary = filter === 'all' 
                ? learningData.vocabulary 
                : learningData.vocabulary.filter(item => item.category === filter || item.volume === filter);
            
            filteredVocabulary.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card-flip bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg';
                card.setAttribute('data-category', item.category);
                card.setAttribute('data-volume', item.volume);
                
                const isLearned = localStorage.getItem(`vocab_${item.word}`) === 'learned';
                
                card.innerHTML = `
                    <div class="card-inner relative w-full h-64">
                        <div class="card-front absolute w-full h-full flex flex-col items-center justify-center p-6 bg-white">
                            <div class="absolute top-3 right-3 text-xs text-gray-500">
                                ${item.volume}
                            </div>
                            <h3 class="text-2xl font-bold text-neutral mb-2">${item.word}</h3>
                            <p class="text-sm text-gray-500 mb-4">${item.pronunciation}</p>
                            <div class="flex gap-2 mt-auto">
                                <button class="toggle-card px-3 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors">
                                    查看释义
                                </button>
                                <button class="mark-learned px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors ${isLearned ? 'bg-green-100 text-green-700' : ''}" data-word="${item.word}">
                                    ${isLearned ? '<i class="fa fa-check"></i> 已学习' : '<i class="fa fa-bookmark-o"></i> 标记学习'}
                                </button>
                            </div>
                        </div>
                        <div class="card-back absolute w-full h-full flex flex-col items-center justify-center p-6 bg-neutral-light">
                            <div class="absolute top-3 right-3 text-xs text-gray-500">
                                ${item.volume}
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-4">${item.translation}</h3>
                            <p class="text-sm text-gray-600 mb-4 text-center">${item.explanation}</p>
                            <div class="mt-auto">
                                <button class="toggle-card px-3 py-1 bg-primary text-white rounded-full text-sm hover:bg-primary/90 transition-colors">
                                    返回
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
                
                // 添加卡片翻转事件
                card.querySelectorAll('.toggle-card').forEach(btn => {
                    btn.addEventListener('click', () => {
                        card.classList.toggle('card-flipped');
                    });
                });
                
                // 添加标记学习事件
                const markBtn = card.querySelector('.mark-learned');
                markBtn.addEventListener('click', function() {
                    const word = this.getAttribute('data-word');
                    const isLearned = localStorage.getItem(`vocab_${word}`) === 'learned';
                    
                    if (isLearned) {
                        localStorage.removeItem(`vocab_${word}`);
                        this.innerHTML = '<i class="fa fa-bookmark-o"></i> 标记学习';
                        this.classList.remove('bg-green-100', 'text-green-700');
                        this.classList.add('bg-gray-100', 'text-gray-700');
                    } else {
                        localStorage.setItem(`vocab_${word}`, 'learned');
                        this.innerHTML = '<i class="fa fa-check"></i> 已学习';
                        this.classList.remove('bg-gray-100', 'text-gray-700');
                        this.classList.add('bg-green-100', 'text-green-700');
                    }
                    
                    // 更新学习统计
                    initLearningStats();
                });
            });
        }

        // 渲染语法卡片
        function renderGrammarCards(filter = 'all') {
            const container = document.getElementById('grammarCards');
            container.innerHTML = '';
            
            const filteredGrammar = filter === 'all' 
                ? learningData.grammar 
                : learningData.grammar.filter(item => item.category === filter || item.volume === filter);
            
            filteredGrammar.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card-flip bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg';
                card.setAttribute('data-category', item.category);
                card.setAttribute('data-volume', item.volume);
                
                const isLearned = localStorage.getItem(`grammar_${item.title}`) === 'learned';
                
                card.innerHTML = `
                    <div class="card-inner relative w-full h-64">
                        <div class="card-front absolute w-full h-full flex flex-col items-center justify-center p-6 bg-white">
                            <div class="absolute top-3 right-3 text-xs text-gray-500">
                                ${item.volume}
                            </div>
                            <h3 class="text-xl font-bold text-neutral mb-2">${item.title}</h3>
                            <p class="text-sm text-gray-600 text-center mb-4 max-w-xs">${item.explanation}</p>
                            <div class="flex gap-2 mt-auto">
                                <button class="toggle-card px-3 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors">
                                    查看例句
                                </button>
                                <button class="mark-learned px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors ${isLearned ? 'bg-green-100 text-green-700' : ''}" data-title="${item.title}">
                                    ${isLearned ? '<i class="fa fa-check"></i> 已学习' : '<i class="fa fa-bookmark-o"></i> 标记学习'}
                                </button>
                            </div>
                        </div>
                        <div class="card-back absolute w-full h-full flex flex-col items-center justify-center p-6 bg-neutral-light">
                            <div class="absolute top-3 right-3 text-xs text-gray-500">
                                ${item.volume}
                            </div>
                            <h3 class="text-lg font-bold text-primary mb-4">例句</h3>
                            <p class="text-sm text-gray-600 text-center mb-4 max-w-xs">${item.example}</p>
                            <div class="mt-auto">
                                <button class="toggle-card px-3 py-1 bg-primary text-white rounded-full text-sm hover:bg-primary/90 transition-colors">
                                    返回
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
                
                // 添加卡片翻转事件
                card.querySelectorAll('.toggle-card').forEach(btn => {
                    btn.addEventListener('click', () => {
                        card.classList.toggle('card-flipped');
                    });
                });
                
                // 添加标记学习事件
                const markBtn = card.querySelector('.mark-learned');
                markBtn.addEventListener('click', function() {
                    const title = this.getAttribute('data-title');
                    const isLearned = localStorage.getItem(`grammar_${title}`) === 'learned';
                    
                    if (isLearned) {
                        localStorage.removeItem(`grammar_${title}`);
                        this.innerHTML = '<i class="fa fa-bookmark-o"></i> 标记学习';
                        this.classList.remove('bg-green-100', 'text-green-700');
                        this.classList.add('bg-gray-100', 'text-gray-700');
                    } else {
                        localStorage.setItem(`grammar_${title}`, 'learned');
                        this.innerHTML = '<i class="fa fa-check"></i> 已学习';
                        this.classList.remove('bg-gray-100', 'text-gray-700');
                        this.classList.add('bg-green-100', 'text-green-700');
                    }
                    
                    // 更新学习统计
                    initLearningStats();
                });
            });
        }

        // 初始化学习统计
        function initLearningStats() {
            // 计算单词学习进度
            const totalVocab = learningData.vocabulary.length;
            let learnedVocab = 0;
            learningData.vocabulary.forEach(item => {
                if (localStorage.getItem(`vocab_${item.word}`) === 'learned') {
                    learnedVocab++;
                }
            });
            const vocabProgress = Math.round((learnedVocab / totalVocab) * 100);
            
            // 计算语法学习进度
            const totalGrammar = learningData.grammar.length;
            let learnedGrammar = 0;
            learningData.grammar.forEach(item => {
                if (localStorage.getItem(`grammar_${item.title}`) === 'learned') {
                    learnedGrammar++;
                }
            });
            const grammarProgress = Math.round((learnedGrammar / totalGrammar) * 100);
            
            // 计算测试进度
            const totalTests = 10; // 假设总共有10种测试
            const completedTests = learningData.tests.length;
            const testProgress = Math.round((completedTests / totalTests) * 100);
            
            // 更新进度条
            document.getElementById('vocabProgressBar').style.width = `${vocabProgress}%`;
            document.getElementById('vocabProgressText').textContent = `${learnedVocab}/${totalVocab}`;
            
            document.getElementById('grammarProgressBar').style.width = `${grammarProgress}%`;
            document.getElementById('grammarProgressText').textContent = `${learnedGrammar}/${totalGrammar}`;
            
            document.getElementById('testProgressBar').style.width = `${testProgress}%`;
            document.getElementById('testProgressText').textContent = `${completedTests}/${totalTests}`;
            
            // 创建成绩图表
            const ctx = document.getElementById('scoreChart');
            if (ctx && typeof Chart !== 'undefined') {
                // 如果已有图表实例，先销毁它
                if (window.scoreChartInstance) {
                    window.scoreChartInstance.destroy();
                }
                
                const scores = learningData.tests.map(test => test.score);
                const labels = scores.map((_, index) => `测试 ${index + 1}`);
                
                window.scoreChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '测试成绩',
                            data: scores,
                            borderColor: '#4F46E5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `得分: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // 生成学习建议
            const tipsContainer = document.getElementById('learningTips');
            tipsContainer.innerHTML = '';
            
            const tips = [
                { icon: 'fa-book', text: `你已经学习了 ${learnedVocab} 个单词，继续加油！` },
                { icon: 'fa-code-fork', text: `你已经掌握了 ${learnedGrammar} 个语法点，继续努力！` },
                { icon: 'fa-check-square-o', text: `你已经完成了 ${completedTests} 次测试，平均得分 ${getAverageScore()}%` },
                { icon: 'fa-star', text: `你最近的一次测试得分是 ${getLatestScore()}%，继续保持！` },
                { icon: 'fa-line-chart', text: `你的学习进度是 ${Math.round((vocabProgress + grammarProgress + testProgress) / 3)}%，表现不错！` }
            ];
            
            tips.forEach(tip => {
                const tipElement = document.createElement('div');
                tipElement.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-100';
                tipElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-primary/10 p-2 rounded-md">
                            <i class="fa ${tip.icon} text-primary"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-gray-600">${tip.text}</p>
                        </div>
                    </div>
                `;
                tipsContainer.appendChild(tipElement);
            });
        }

        // 获取平均分数
        function getAverageScore() {
            if (learningData.tests.length === 0) return 0;
            const total = learningData.tests.reduce((sum, test) => sum + test.score, 0);
            return Math.round(total / learningData.tests.length);
        }

        // 获取最新分数
        function getLatestScore() {
            if (learningData.tests.length === 0) return 0;
            return learningData.tests[learningData.tests.length - 1].score;
        }

        // 初始化导航栏滚动效果
        function initScrollEffects() {
            const nav = document.getElementById('mainNav');
            window.addEventListener('scroll', function() {
                if (window.scrollY > 10) {
                    nav.classList.add('bg-white/95', 'backdrop-blur-sm');
                    nav.classList.remove('bg-white');
                } else {
                    nav.classList.remove('bg-white/95', 'backdrop-blur-sm');
                    nav.classList.add('bg-white');
                }
            });
        }

        // 初始化移动端菜单
        function initMobileMenu() {
            const menuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            menuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
            
            // 点击菜单项后关闭菜单
            const menuItems = mobileMenu.querySelectorAll('a');
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    mobileMenu.classList.add('hidden');
                });
            });
        }

        // 初始化测试功能
        function initTestFunctionality() {
            const startTestBtn = document.getElementById('startTest');
            const prevQuestionBtn = document.getElementById('prevQuestion');
            const nextQuestionBtn = document.getElementById('nextQuestion');
            const reviewAnswersBtn = document.getElementById('reviewAnswers');
            const retakeTestBtn = document.getElementById('retakeTest');
            
            // 开始测试
            startTestBtn.addEventListener('click', function() {
                const testType = document.getElementById('testType').value;
                const questionCount = parseInt(document.getElementById('questionCount').value);
                
                generateTestQuestions(testType, questionCount);
                showTestArea();
            });
            
            // 上一题
            prevQuestionBtn.addEventListener('click', function() {
                if (testData.currentQuestionIndex > 0) {
                    testData.currentQuestionIndex--;
                    renderCurrentQuestion();
                }
            });
            
            // 下一题
            nextQuestionBtn.addEventListener('click', function() {
                if (testData.currentQuestionIndex < testData.questions.length - 1) {
                    testData.currentQuestionIndex++;
                    renderCurrentQuestion();
                } else {
                    // 完成测试
                    finishTest();
                }
            });
            
            // 查看错题
            reviewAnswersBtn.addEventListener('click', function() {
                showWrongAnswersReview();
            });
            
            // 再测一次
            retakeTestBtn.addEventListener('click', function() {
                const testType = document.getElementById('testType').value;
                const questionCount = parseInt(document.getElementById('questionCount').value);
                
                generateTestQuestions(testType, questionCount);
                showTestArea();
            });
            
            // 关闭错题回顾
            const closeReviewBtn = document.getElementById('closeReview');
            closeReviewBtn.addEventListener('click', function() {
                hideWrongAnswersReview();
            });
        }

        // 生成测试题目
        function generateTestQuestions(testType, questionCount) {
            testData.questions = [];
            testData.userAnswers = Array(questionCount).fill(null);
            testData.currentQuestionIndex = 0;
            
            let allQuestions = [];
            
            if (testType === 'vocabulary' || testType === 'mixed') {
                // 添加单词题目
                const vocabQuestions = createVocabularyQuestions(Math.floor(questionCount / 2));
                allQuestions = [...allQuestions, ...vocabQuestions];
            }
            
            if (testType === 'grammar' || testType === 'mixed') {
                // 添加语法题目
                const grammarQuestions = createGrammarQuestions(questionCount - allQuestions.length);
                allQuestions = [...allQuestions, ...grammarQuestions];
            }
            
            // 打乱题目顺序
            testData.questions = shuffleArray(allQuestions);
            
            // 保存当前测试类型
            testData.currentTest = testType;
        }

        // 创建单词测试题目
        function createVocabularyQuestions(count) {
            const questions = [];
            const shuffledVocab = shuffleArray([...learningData.vocabulary]);
            
            for (let i = 0; i < count; i++) {
                const vocabItem = shuffledVocab[i % shuffledVocab.length];
                
                // 随机决定是选择题还是填空题
                if (Math.random() > 0.5) {
                    // 选择题：给出单词，选择正确翻译
                    const options = [vocabItem.translation];
                    
                    // 生成3个错误选项
                    while (options.length < 4) {
                        const randomVocab = shuffledVocab[Math.floor(Math.random() * shuffledVocab.length)];
                        if (!options.includes(randomVocab.translation)) {
                            options.push(randomVocab.translation);
                        }
                    }
                    
                    // 打乱选项顺序
                    const shuffledOptions = shuffleArray(options);
                    
                    questions.push({
                        type: 'vocabulary',
                        question: `"${vocabItem.word}" 的中文意思是什么？`,
                        correctAnswer: vocabItem.translation,
                        options: shuffledOptions,
                        originalItem: vocabItem
                    });
                } else {
                    // 填空题：给出翻译，填写单词
                    questions.push({
                        type: 'vocabulary',
                        question: `请将 "${vocabItem.translation}" 翻译成英文。`,
                        correctAnswer: vocabItem.word.toLowerCase(),
                        originalItem: vocabItem
                    });
                }
            }
            
            return questions;
        }

        // 创建语法测试题目
        function createGrammarQuestions(count) {
            const questions = [];
            const shuffledGrammar = shuffleArray([...learningData.grammar]);
            
            for (let i = 0; i < count; i++) {
                const grammarItem = shuffledGrammar[i % shuffledGrammar.length];
                
                // 随机决定是选择题还是填空题
                if (Math.random() > 0.5) {
                    // 选择题：给出例句，选择正确语法解释
                    const options = [grammarItem.explanation];
                    
                    // 生成3个错误选项
                    while (options.length < 4) {
                        const randomGrammar = shuffledGrammar[Math.floor(Math.random() * shuffledGrammar.length)];
                        if (!options.includes(randomGrammar.explanation)) {
                            options.push(randomGrammar.explanation);
                        }
                    }
                    
                    // 打乱选项顺序
                    const shuffledOptions = shuffleArray(options);
                    
                    questions.push({
                        type: 'grammar',
                        question: `这个句子使用了什么语法结构？"${grammarItem.example}"`,
                        correctAnswer: grammarItem.explanation,
                        options: shuffledOptions,
                        originalItem: grammarItem
                    });
                } else {
                    // 填空题：给出语法点，填写正确例句
                    questions.push({
                        type: 'grammar',
                        question: `请使用 "${grammarItem.title}" 语法结构造一个句子。`,
                        correctAnswer: grammarItem.example.toLowerCase(),
                        originalItem: grammarItem
                    });
                }
            }
            
            return questions;
        }

        // 显示测试区域
        function showTestArea() {
            document.getElementById('testArea').classList.remove('hidden');
            document.getElementById('testResults').classList.add('hidden');
            
            document.getElementById('testTitle').textContent = testData.currentTest === 'vocabulary' 
                ? '单词测试' 
                : testData.currentTest === 'grammar' 
                    ? '语法测试' 
                    : '混合测试';
            
            renderCurrentQuestion();
        }

        // 渲染当前题目
        function renderCurrentQuestion() {
            const question = testData.questions[testData.currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            container.innerHTML = '';
            
            // 更新进度
            document.getElementById('testProgressBar').style.width = `${((testData.currentQuestionIndex + 1) / testData.questions.length) * 100}%`;
            document.getElementById('testProgressText').textContent = `${testData.currentQuestionIndex + 1}/${testData.questions.length}`;
            
            // 隐藏答案反馈
            document.getElementById('answerFeedback').classList.add('hidden');
            document.getElementById('correctFeedback').classList.add('hidden');
            document.getElementById('incorrectFeedback').classList.add('hidden');
            
            // 禁用/启用导航按钮
            document.getElementById('prevQuestion').disabled = testData.currentQuestionIndex === 0;
            document.getElementById('nextQuestion').textContent = testData.currentQuestionIndex === testData.questions.length - 1 
                ? '完成测试' 
                : '下一题';
            
            // 创建题目元素
            const questionElement = document.createElement('div');
            
            // 题目编号
            const questionNumber = document.createElement('div');
            questionNumber.className = 'text-sm font-medium text-gray-500 mb-2';
            questionNumber.textContent = `问题 ${testData.currentQuestionIndex + 1}/${testData.questions.length}`;
            questionElement.appendChild(questionNumber);
            
            // 题目内容
            const questionContent = document.createElement('div');
            questionContent.className = 'text-lg font-medium text-neutral mb-4';
            questionContent.textContent = question.question;
            questionElement.appendChild(questionContent);
            
            // 根据题目类型创建不同的UI
            if (question.options) {
                // 选择题
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'space-y-2';
                
                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'flex items-center';
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `question-${testData.currentQuestionIndex}`;
                    input.id = `option-${testData.currentQuestionIndex}-${index}`;
                    input.value = option;
                    input.className = 'h-4 w-4 text-primary focus:ring-primary border-gray-300';
                    
                    // 如果已经选择了答案，恢复选中状态
                    if (testData.userAnswers[testData.currentQuestionIndex] === option) {
                        input.checked = true;
                    }
                    
                    input.addEventListener('change', function() {
                        testData.userAnswers[testData.currentQuestionIndex] = this.value;
                    });
                    
                    const label = document.createElement('label');
                    label.htmlFor = `option-${testData.currentQuestionIndex}-${index}`;
                    label.className = 'ml-3 block text-sm text-gray-700';
                    label.textContent = option;
                    
                    optionElement.appendChild(input);
                    optionElement.appendChild(label);
                    optionsContainer.appendChild(optionElement);
                });
                
                questionElement.appendChild(optionsContainer);
            } else {
                // 填空题
                const inputContainer = document.createElement('div');
                inputContainer.className = 'mt-2';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/20 focus:ring-opacity-50';
                
                // 如果已经输入了答案，恢复输入内容
                if (testData.userAnswers[testData.currentQuestionIndex]) {
                    input.value = testData.userAnswers[testData.currentQuestionIndex];
                }
                
                input.addEventListener('input', function() {
                    testData.userAnswers[testData.currentQuestionIndex] = this.value;
                });
                
                inputContainer.appendChild(input);
                questionElement.appendChild(inputContainer);
            }
            
            container.appendChild(questionElement);
        }

        // 智能答案判断函数
        function isAnswerCorrect(userAnswer, correctAnswer, question) {
            if (!userAnswer || userAnswer.trim() === '') {
                return false;
            }
            
            const userText = userAnswer.toLowerCase().trim();
            const correctText = correctAnswer.toLowerCase().trim();
            
            // 完全匹配
            if (userText === correctText) {
                return true;
            }
            
            // 基于题目类型的智能判断
            if (question.type === 'vocabulary') {
                if (question.question.includes('中文意思')) {
                    // 英译中：检查是否包含关键词
                    const keywords = correctText.split(/[，,、；;]/).map(k => k.trim()).filter(k => k.length > 0);
                    return keywords.some(keyword => userText.includes(keyword));
                } else {
                    // 中译英：检查核心单词
                    const coreWords = correctText.split(/\s+/);
                    return coreWords.some(word => userText.includes(word));
                }
            } else if (question.type === 'grammar') {
                if (question.question.includes('语法结构')) {
                    // 语法识别：检查关键术语
                    const grammarTerms = correctText.split(/[，,、；;]/).map(t => t.trim()).filter(t => t.length > 0);
                    return grammarTerms.some(term => userText.includes(term));
                } else {
                    // 造句题：更宽松的判断，检查是否包含关键语法结构
                    const item = question.originalItem;
                    const grammarPattern = item.title.toLowerCase();
                    
                    // 检查是否包含语法结构的关键词
                    if (grammarPattern.includes('present') && userText.match(/\b(am|is|are|do|does)\b/)) {
                        return true;
                    }
                    if (grammarPattern.includes('past') && userText.match(/\b(was|were|did|ed\b)/)) {
                        return true;
                    }
                    if (grammarPattern.includes('future') && userText.match(/\b(will|going to)\b/)) {
                        return true;
                    }
                    if (grammarPattern.includes('question') && userText.match(/^(what|where|when|why|how|do|does|did|is|are|was|were)/)) {
                        return true;
                    }
                    
                    // 基本语法检查：至少包含主语和谓语
                    const words = userText.split(/\s+/).filter(w => w.length > 0);
                    return words.length >= 3; // 至少3个词构成基本句子
                }
            }
            
            return false;
        }
        
        // 生成题目解析（包括正确和错误答案）
        function generateExplanation(question, userAnswer, isCorrect) {
            const item = question.originalItem;
            let explanation = '';
            
            // 用户答案部分
            if (userAnswer && userAnswer !== '未作答') {
                if (isCorrect) {
                    explanation = `✅ 你的答案：「${userAnswer}」 - 回答正确！\n\n`;
                } else {
                    explanation = `❌ 你的答案：「${userAnswer}」\n\n`;
                }
            } else {
                explanation = `⚠️ 你未作答此题。\n\n`;
            }
            
            // 知识点解析
            if (question.type === 'vocabulary') {
                if (question.question.includes('中文意思')) {
                    // 英译中题目
                    explanation += `📖 知识点解析：\n` +
                                 `正确答案：「${question.correctAnswer}」\n` +
                                 `单词：${item.word}\n` +
                                 `音标：${item.pronunciation}\n` +
                                 `词性：${item.category}\n` +
                                 `详细解释：${item.explanation}`;
                } else {
                    // 中译英题目
                    explanation += `📖 知识点解析：\n` +
                                 `正确答案：「${question.correctAnswer}」\n` +
                                 `中文含义：${item.translation}\n` +
                                 `音标：${item.pronunciation}\n` +
                                 `记忆提示：${item.explanation}`;
                }
            } else if (question.type === 'grammar') {
                if (question.question.includes('语法结构')) {
                    // 语法识别题目
                    explanation += `📖 知识点解析：\n` +
                                 `正确答案：「${question.correctAnswer}」\n` +
                                 `例句：${item.example}\n` +
                                 `语法结构：${item.title}\n` +
                                 `用法说明：${item.explanation}`;
                } else {
                    // 造句题目
                    explanation += `📖 知识点解析：\n` +
                                 `参考答案：「${question.correctAnswer}」\n` +
                                 `语法结构：${item.title}\n` +
                                 `用法说明：${item.explanation}\n` +
                                 `标准例句：${item.example}`;
                    
                    if (isCorrect) {
                        explanation += `\n\n💡 你的句子符合语法要求，很棒！`;
                    } else if (userAnswer && userAnswer !== '未作答') {
                        explanation += `\n\n💡 建议：确保句子包含正确的语法结构，可以参考标准例句的格式。`;
                    }
                }
            }
            
            return explanation;
        }

        // 完成测试
        function finishTest() {
            // 计算得分并记录详细答题结果
            let correctCount = 0;
            const detailedResults = [];
            
            testData.questions.forEach((question, index) => {
                const userAnswer = testData.userAnswers[index];
                const isCorrect = isAnswerCorrect(userAnswer, question.correctAnswer, question);
                
                if (isCorrect) {
                    correctCount++;
                }
                
                // 记录每道题的详细结果
                const questionResult = {
                    questionIndex: index,
                    question: question.question,
                    userAnswer: userAnswer || '未作答',
                    correctAnswer: question.correctAnswer,
                    isCorrect: isCorrect,
                    type: question.type,
                    originalItem: question.originalItem,
                    // 生成题目解析（包括正确和错误答案）
                    explanation: generateExplanation(question, userAnswer, isCorrect)
                };
                
                detailedResults.push(questionResult);
            });
            
            const score = Math.round((correctCount / testData.questions.length) * 100);
            
            // 保存测试结果（包含详细答题记录）
            const testResult = {
                date: new Date().toISOString(),
                type: testData.currentTest,
                score: score,
                totalQuestions: testData.questions.length,
                correctCount: correctCount,
                wrongCount: testData.questions.length - correctCount,
                detailedResults: detailedResults,
                // 保留原有字段以兼容旧版本
                questions: testData.questions,
                answers: testData.userAnswers
            };
            
            // 将结果添加到历史记录中
            learningData.tests.push(testResult);
            
            // 限制历史记录为最近20条
            if (learningData.tests.length > 20) {
                learningData.tests.shift();
            }
            
            // 保存到本地存储
            localStorage.setItem('englishLearningTests', JSON.stringify(learningData.tests));
            
            // 更新学习统计
            initLearningStats();
            
            // 显示测试结果
            document.getElementById('testArea').classList.add('hidden');
            document.getElementById('testResults').classList.remove('hidden');
            document.getElementById('finalScore').textContent = `${score}% (${correctCount}/${testData.questions.length})`;
            
            // 更新历史得分
            renderTestHistory();
            
            // 保存当前测试结果到全局变量，供错题回顾使用
            window.currentTestResult = testResult;
        }

        // 渲染测试历史
        function renderTestHistory() {
            const container = document.getElementById('scoreHistory');
            container.innerHTML = '';
            
            // 只显示最近5次测试
            const recentTests = learningData.tests.slice(-5);
            
            recentTests.forEach((test, index) => {
                const scoreElement = document.createElement('div');
                scoreElement.className = 'bg-white rounded-lg shadow-sm p-2 text-center';
                
                const date = new Date(test.date);
                const formattedDate = `${date.getMonth() + 1}/${date.getDate()}`;
                
                scoreElement.innerHTML = `
                    <div class="text-xs text-gray-500 mb-1">${formattedDate}</div>
                    <div class="font-bold text-primary">${test.score}%</div>
                `;
                
                container.appendChild(scoreElement);
            });
        }
        
        // 显示错题回顾
        function showWrongAnswersReview() {
            const reviewContainer = document.getElementById('wrongAnswersReview');
            const wrongAnswersList = document.getElementById('wrongAnswersList');
            
            if (!window.currentTestResult || !window.currentTestResult.detailedResults) {
                alert('没有找到测试结果数据');
                return;
            }
            
            // 筛选出错题
            const wrongAnswers = window.currentTestResult.detailedResults.filter(result => !result.isCorrect);
            
            if (wrongAnswers.length === 0) {
                wrongAnswersList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fa fa-check-circle text-green-500 text-4xl mb-4"></i>
                        <p class="text-lg font-medium">恭喜！本次测试全部答对！</p>
                        <p class="text-sm">继续保持这种优秀的学习状态！</p>
                    </div>
                `;
            } else {
                wrongAnswersList.innerHTML = '';
                
                wrongAnswers.forEach((wrongAnswer, index) => {
                    const wrongAnswerElement = document.createElement('div');
                    wrongAnswerElement.className = 'border border-red-200 rounded-lg p-4 bg-red-50';
                    
                    wrongAnswerElement.innerHTML = `
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center">
                                <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-red-500 text-white text-sm font-medium mr-3">
                                    ${wrongAnswer.questionIndex + 1}
                                </span>
                                <span class="text-sm font-medium text-gray-600">${wrongAnswer.type === 'vocabulary' ? '词汇题' : '语法题'}</span>
                            </div>
                            <i class="fa fa-times-circle text-red-500"></i>
                        </div>
                        
                        <div class="mb-3">
                            <p class="font-medium text-gray-800 mb-2">题目：</p>
                            <p class="text-gray-700 bg-white p-2 rounded border">${wrongAnswer.question}</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <div>
                                <p class="font-medium text-red-600 mb-1">你的答案：</p>
                                <p class="text-red-700 bg-red-100 p-2 rounded">${wrongAnswer.userAnswer}</p>
                            </div>
                            <div>
                                <p class="font-medium text-green-600 mb-1">正确答案：</p>
                                <p class="text-green-700 bg-green-100 p-2 rounded">${wrongAnswer.correctAnswer}</p>
                            </div>
                        </div>
                        
                        <div class="border-t border-red-200 pt-3">
                            <p class="font-medium text-gray-800 mb-2">
                                <i class="fa fa-lightbulb-o text-yellow-500 mr-1"></i>
                                详细解析：
                            </p>
                            <div class="text-gray-700 bg-white p-3 rounded border whitespace-pre-line">${wrongAnswer.explanation}</div>
                        </div>
                    `;
                    
                    wrongAnswersList.appendChild(wrongAnswerElement);
                });
            }
            
            reviewContainer.classList.remove('hidden');
        }
        
        // 隐藏错题回顾
        function hideWrongAnswersReview() {
            document.getElementById('wrongAnswersReview').classList.add('hidden');
        }

        // 初始化主题切换
        function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            // 设置初始主题
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                themeToggle.innerHTML = '<i class="fa fa-sun-o"></i>';
            } else {
                document.documentElement.classList.remove('dark');
                themeToggle.innerHTML = '<i class="fa fa-moon-o"></i>';
            }
            
            // 切换主题
            themeToggle.addEventListener('click', function() {
                const isDarkMode = document.documentElement.classList.toggle('dark');
                localStorage.setItem('darkMode', isDarkMode);
                
                if (isDarkMode) {
                    themeToggle.innerHTML = '<i class="fa fa-sun-o"></i>';
                } else {
                    themeToggle.innerHTML = '<i class="fa fa-moon-o"></i>';
                }
            });
        }

        // 初始化返回顶部按钮
        function initBackToTopButton() {
            const backToTopButton = document.getElementById('backToTop');
            
            window.addEventListener('scroll', function() {
                if (window.scrollY > 300) {
                    backToTopButton.classList.remove('opacity-0', 'invisible');
                    backToTopButton.classList.add('opacity-100', 'visible');
                } else {
                    backToTopButton.classList.remove('opacity-100', 'visible');
                    backToTopButton.classList.add('opacity-0', 'invisible');
                }
            });
            
            backToTopButton.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // 随机打乱数组
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // 添加筛选事件
        document.querySelectorAll('.vocab-filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // 移除所有按钮的活跃状态
                document.querySelectorAll('.vocab-filter-btn').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-gray-100', 'text-gray-700');
                });
                
                // 添加当前按钮的活跃状态
                this.classList.remove('bg-gray-100', 'text-gray-700');
                this.classList.add('bg-primary', 'text-white');
                
                // 筛选单词卡片
                const filter = this.getAttribute('data-filter');
                renderVocabularyCards(filter);
            });
        });

        document.querySelectorAll('.grammar-filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // 移除所有按钮的活跃状态
                document.querySelectorAll('.grammar-filter-btn').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-gray-100', 'text-gray-700');
                });
                
                // 添加当前按钮的活跃状态
                this.classList.remove('bg-gray-100', 'text-gray-700');
                this.classList.add('bg-primary', 'text-white');
                
                // 筛选语法卡片
                const filter = this.getAttribute('data-filter');
                renderGrammarCards(filter);
            });
        });

        // 添加随机排序事件
        document.getElementById('vocabShuffle').addEventListener('click', function() {
            const cards = Array.from(document.querySelectorAll('#vocabularyCards > div'));
            const container = document.getElementById('vocabularyCards');
            
            // 清空容器
            container.innerHTML = '';
            
            // 随机排序并添加回容器
            shuffleArray(cards).forEach(card => {
                container.appendChild(card);
            });
            
            // 添加动画效果
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('slide-in');
                    setTimeout(() => {
                        card.classList.remove('slide-in');
                    }, 500);
                }, index * 50);
            });
        });

        document.getElementById('grammarShuffle').addEventListener('click', function() {
            const cards = Array.from(document.querySelectorAll('#grammarCards > div'));
            const container = document.getElementById('grammarCards');
            
            // 清空容器
            container.innerHTML = '';
            
            // 随机排序并添加回容器
            shuffleArray(cards).forEach(card => {
                container.appendChild(card);
            });
            
            // 添加动画效果
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('slide-in');
                    setTimeout(() => {
                        card.classList.remove('slide-in');
                    }, 500);
                }, index * 50);
            });
        });

        // 添加重置事件
        document.getElementById('vocabReset').addEventListener('click', function() {
            const filter = document.querySelector('.vocab-filter-btn.bg-primary').getAttribute('data-filter');
            renderVocabularyCards(filter);
        });

        document.getElementById('grammarReset').addEventListener('click', function() {
            const filter = document.querySelector('.grammar-filter-btn.bg-primary').getAttribute('data-filter');
            renderGrammarCards(filter);
        });
    </script>
</body>
</html>
    