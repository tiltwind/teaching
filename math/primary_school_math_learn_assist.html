<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å­¦æ•°å­¦å­¦ä¹ åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#F59E0B',
                        accent: '#10B981',
                        neutral: '#1F2937',
                        'neutral-light': '#F3F4F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-flip {
                perspective: 1000px;
                transform-style: preserve-3d;
            }
            .card-front, .card-back {
                backface-visibility: hidden;
                transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .card-back {
                transform: rotateY(180deg);
            }
            .card-flipped .card-front {
                transform: rotateY(180deg);
            }
            .card-flipped .card-back {
                transform: rotateY(0deg);
            }
            .progress-animation {
                transition: width 1s ease-in-out;
            }
            .slide-in {
                animation: slideIn 0.5s ease-out forwards;
            }
            @keyframes slideIn {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            .pulse {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            .math-formula {
                font-family: 'Times New Roman', serif;
                font-size: 1.1em;
            }
            .card-flip {
                perspective: 1000px;
            }
            .card-front, .card-back {
                backface-visibility: hidden;
                transition: transform 0.6s;
            }
            .card-back {
                transform: rotateY(180deg);
            }
            .card-flip:hover .card-front {
                transform: rotateY(180deg);
            }
            .card-flip:hover .card-back {
                transform: rotateY(0deg);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen font-sans">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-md fixed w-full z-50 transition-all duration-300" id="mainNav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="#" class="flex-shrink-0 flex items-center">
                        <i class="fa fa-calculator text-primary text-2xl mr-2"></i>
                        <span class="text-xl font-bold text-neutral">å°å­¦æ•°å­¦å­¦ä¹ åŠ©æ‰‹</span>
                    </a>
                    <div class="hidden sm:ml-6 sm:flex space-x-8">
                        <a href="#knowledge" class="border-primary text-primary border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-book mr-1"></i> çŸ¥è¯†å­¦ä¹ 
                        </a>
                        <a href="#practice" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-pencil mr-1"></i> ç»ƒä¹ é¢˜åº“
                        </a>
                        <a href="#test" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-check-square-o mr-1"></i> çŸ¥è¯†æµ‹è¯•
                        </a>
                        <a href="#bonus" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-star mr-1"></i> é™„åŠ é¢˜
                        </a>
                        <a href="#stats" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium">
                            <i class="fa fa-bar-chart mr-1"></i> å­¦ä¹ ç»Ÿè®¡
                        </a>
                    </div>
                </div>
                <div class="flex items-center">
                    <button id="themeToggle" class="p-2 rounded-full text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
                        <i class="fa fa-moon-o"></i>
                    </button>
                    <button type="button" class="ml-4 p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none sm:hidden" id="mobileMenuButton">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div class="sm:hidden hidden" id="mobileMenu">
            <div class="px-2 pt-2 pb-3 space-y-1 bg-white shadow-lg">
                <a href="#knowledge" class="bg-primary/10 text-primary block pl-3 pr-4 py-2 border-l-4 border-primary text-base font-medium">
                    <i class="fa fa-book mr-1"></i> çŸ¥è¯†å­¦ä¹ 
                </a>
                <a href="#practice" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-pencil mr-1"></i> ç»ƒä¹ é¢˜åº“
                </a>
                <a href="#test" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-check-square-o mr-1"></i> çŸ¥è¯†æµ‹è¯•
                </a>
                <a href="#bonus" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-star mr-1"></i> é™„åŠ é¢˜
                </a>
                <a href="#stats" class="border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 hover:border-gray-300 block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium">
                    <i class="fa fa-bar-chart mr-1"></i> å­¦ä¹ ç»Ÿè®¡
                </a>
            </div>
        </div>
    </nav>

    <!-- è‹±é›„åŒºåŸŸ -->
    <header class="pt-24 pb-12 md:pt-32 md:pb-20 bg-gradient-to-r from-primary to-secondary text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold leading-tight mb-4">
                    å°å­¦æ•°å­¦å­¦ä¹ åŠ©æ‰‹
                </h1>
                <p class="text-[clamp(1rem,2vw,1.25rem)] text-white/80 max-w-3xl mx-auto mb-8">
                    è½»æ¾æŒæ¡äººæ•™ç‰ˆå°å­¦äº”å¹´çº§æ•°å­¦çŸ¥è¯†ç‚¹ï¼Œé€šè¿‡äº’åŠ¨å­¦ä¹ å’Œæµ‹è¯•å·©å›ºè®°å¿†
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#knowledge" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-accent hover:bg-accent/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent transition-all duration-300 transform hover:scale-105">
                        <i class="fa fa-book mr-2"></i> å¼€å§‹å­¦ä¹ 
                    </a>
                    <a href="#test" class="inline-flex items-center justify-center px-6 py-3 border border-white text-base font-medium rounded-md text-white bg-transparent hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white transition-all duration-300 transform hover:scale-105">
                        <i class="fa fa-check-square-o mr-2"></i> ç«‹å³æµ‹è¯•
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- çŸ¥è¯†å­¦ä¹ éƒ¨åˆ† -->
        <section id="knowledge" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-book text-primary mr-2"></i> çŸ¥è¯†å­¦ä¹ 
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    æŒæ¡äº”å¹´çº§æ•°å­¦æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œé€šè¿‡å¡ç‰‡å­¦ä¹ æ³•åŠ æ·±ç†è§£
                </p>
            </div>

            <!-- çŸ¥è¯†ç­›é€‰å’Œæ§åˆ¶ -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h3 class="text-lg font-semibold text-neutral mb-2">ç­›é€‰çŸ¥è¯†ç‚¹</h3>
                        <div class="flex flex-wrap gap-2">
                            <button class="knowledge-filter-btn px-4 py-2 rounded-full bg-primary text-white text-sm font-medium" data-filter="all">å…¨éƒ¨</button>
                            <button class="knowledge-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="ä¸Šå†Œ">ä¸Šå†Œ</button>
                            <button class="knowledge-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="ä¸‹å†Œ">ä¸‹å†Œ</button>
                            <button class="knowledge-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="è®¡ç®—">è®¡ç®—</button>
                            <button class="knowledge-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="å‡ ä½•">å‡ ä½•</button>
                            <button class="knowledge-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="åº”ç”¨">åº”ç”¨</button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button id="knowledgeShuffle" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-random mr-2"></i> éšæœºæ’åº
                        </button>
                        <button id="knowledgeReset" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-refresh mr-2"></i> é‡ç½®
                        </button>
                    </div>
                </div>
            </div>

            <!-- çŸ¥è¯†å¡ç‰‡ç½‘æ ¼ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="knowledgeCards">
                <!-- çŸ¥è¯†å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- ç»ƒä¹ é¢˜åº“éƒ¨åˆ† -->
        <section id="practice" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-pencil text-primary mr-2"></i> ç»ƒä¹ é¢˜åº“
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    é€šè¿‡å¤§é‡ç»ƒä¹ é¢˜å·©å›ºæ•°å­¦çŸ¥è¯†ï¼Œæé«˜è§£é¢˜èƒ½åŠ›
                </p>
            </div>

            <!-- ç»ƒä¹ ç­›é€‰å’Œæ§åˆ¶ -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h3 class="text-lg font-semibold text-neutral mb-2">ç­›é€‰ç»ƒä¹ é¢˜</h3>
                        <div class="flex flex-wrap gap-2">
                            <button class="practice-filter-btn px-4 py-2 rounded-full bg-primary text-white text-sm font-medium" data-filter="all">å…¨éƒ¨</button>
                            <button class="practice-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="ä¸Šå†Œ">ä¸Šå†Œ</button>
                            <button class="practice-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="ä¸‹å†Œ">ä¸‹å†Œ</button>
                            <button class="practice-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="åŸºç¡€">åŸºç¡€é¢˜</button>
                            <button class="practice-filter-btn px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm font-medium hover:bg-gray-200" data-filter="æé«˜">æé«˜é¢˜</button>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button id="practiceShuffle" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-random mr-2"></i> éšæœºæ’åº
                        </button>
                        <button id="practiceReset" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center">
                            <i class="fa fa-refresh mr-2"></i> é‡ç½®
                        </button>
                    </div>
                </div>
            </div>

            <!-- ç»ƒä¹ é¢˜å¡ç‰‡ç½‘æ ¼ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="practiceCards">
                <!-- ç»ƒä¹ é¢˜å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- æµ‹è¯•éƒ¨åˆ† -->
        <section id="test" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-check-square-o text-primary mr-2"></i> çŸ¥è¯†æµ‹è¯•
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    é€šè¿‡æµ‹è¯•æ£€éªŒå­¦ä¹ æˆæœï¼Œéšæœºå‡ºé¢˜ï¼ŒåŒ…å«é€‰æ‹©é¢˜å’Œè®¡ç®—é¢˜
                </p>
            </div>

            <!-- æµ‹è¯•è®¾ç½® -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6 max-w-3xl mx-auto">
                <h3 class="text-lg font-semibold text-neutral mb-4">æµ‹è¯•è®¾ç½®</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="testType" class="block text-sm font-medium text-gray-700 mb-1">æµ‹è¯•ç±»å‹</label>
                        <select id="testType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/20 focus:ring-opacity-50">
                            <option value="mixed">æ··åˆæµ‹è¯•ï¼ˆè®¡ç®—+åº”ç”¨ï¼‰</option>
                            <option value="calculation">è®¡ç®—æµ‹è¯•</option>
                            <option value="application">åº”ç”¨æµ‹è¯•</option>
                            <option value="geometry">å‡ ä½•æµ‹è¯•</option>
                        </select>
                    </div>
                    <div>
                        <label for="questionCount" class="block text-sm font-medium text-gray-700 mb-1">é¢˜ç›®æ•°é‡</label>
                        <select id="questionCount" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary/20 focus:ring-opacity-50">
                            <option value="5">5é¢˜</option>
                            <option value="10" selected>10é¢˜</option>
                            <option value="15">15é¢˜</option>
                            <option value="20">20é¢˜</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6">
                    <button id="startTest" class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-all duration-300 transform hover:scale-[1.02]">
                        <i class="fa fa-play-circle mr-2"></i> å¼€å§‹æµ‹è¯•
                    </button>
                </div>
            </div>

            <!-- æµ‹è¯•åŒºåŸŸ (é»˜è®¤éšè—) -->
            <div id="testArea" class="hidden max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-neutral" id="testTitle">æ•°å­¦æµ‹è¯•</h3>
                        <div class="flex items-center">
                            <span class="text-sm text-gray-500 mr-2">è¿›åº¦:</span>
                            <div class="w-32 bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full progress-animation" id="testProgressBar" style="width: 0%"></div>
                            </div>
                            <span class="ml-2 text-sm font-medium" id="testProgressText">0/10</span>
                        </div>
                    </div>

                    <div id="questionContainer" class="mb-8">
                        <!-- é¢˜ç›®å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div id="answerFeedback" class="mb-6 hidden">
                        <div id="correctFeedback" class="hidden bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded relative">
                            <strong class="font-bold">æ­£ç¡®!</strong>
                            <span class="block sm:inline" id="correctAnswerText"></span>
                        </div>
                        <div id="incorrectFeedback" class="hidden bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative">
                            <strong class="font-bold">é”™è¯¯!</strong>
                            <span class="block sm:inline" id="incorrectAnswerText"></span>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button id="prevQuestion" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-arrow-left mr-1"></i> ä¸Šä¸€é¢˜
                        </button>
                        <button id="nextQuestion" class="px-4 py-2 border border-transparent rounded-md text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right mr-1"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- æµ‹è¯•ç»“æœ (é»˜è®¤éšè—) -->
            <div id="testResults" class="hidden max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-md p-8 text-center">
                    <div class="mb-6">
                        <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-green-100 text-green-600 mb-4">
                            <i class="fa fa-trophy text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-neutral mb-2">æµ‹è¯•å®Œæˆ!</h3>
                        <p class="text-gray-600 mb-4">ä½ çš„å¾—åˆ†å·²ä¿å­˜åˆ°æœ¬åœ°</p>
                        <div class="text-4xl font-bold text-primary mb-6" id="finalScore">0/10</div>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-lg font-medium text-neutral mb-3">å†å²å¾—åˆ†</h4>
                        <div id="scoreHistory" class="grid grid-cols-2 sm:grid-cols-5 gap-2 max-w-lg mx-auto">
                            <!-- å†å²å¾—åˆ†å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button id="reviewAnswers" class="px-6 py-3 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <i class="fa fa-book mr-1"></i> æŸ¥çœ‹é”™é¢˜
                        </button>
                        <button id="retakeTest" class="px-6 py-3 border border-transparent rounded-md text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                            <i class="fa fa-refresh mr-1"></i> å†æµ‹ä¸€æ¬¡
                        </button>
                    </div>
                </div>
                
                <!-- é”™é¢˜å›é¡¾åŒºåŸŸ -->
                <div id="wrongAnswersReview" class="hidden mt-6 bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium text-neutral">
                            <i class="fa fa-exclamation-triangle text-orange-500 mr-2"></i>
                            é”™é¢˜å›é¡¾ä¸è§£æ
                        </h4>
                        <button id="closeReview" class="text-gray-400 hover:text-gray-600">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div id="wrongAnswersList" class="space-y-4">
                        <!-- é”™é¢˜åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </section>

        <!-- é™„åŠ é¢˜éƒ¨åˆ† -->
        <section id="bonus" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-star text-primary mr-2"></i> é™„åŠ é¢˜
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    æŒ‘æˆ˜ç»¼åˆæ€§éš¾é¢˜ï¼Œæ¶µç›–å¤šä¸ªçŸ¥è¯†ç‚¹çš„é€»è¾‘ç»„åˆï¼Œæå‡æ•°å­¦æ€ç»´èƒ½åŠ›
                </p>
            </div>

            <!-- é™„åŠ é¢˜è®¾ç½® -->
            <div class="mb-8 bg-white rounded-xl shadow-md p-6 max-w-3xl mx-auto">
                <h3 class="text-lg font-semibold text-neutral mb-4">é™„åŠ é¢˜æŒ‘æˆ˜</h3>
                <div class="text-center">
                    <p class="text-gray-600 mb-6">æ¯æ¬¡éšæœºå‡ºä¸€é“ç»¼åˆæ€§éš¾é¢˜ï¼Œæ¶µç›–å¤šä¸ªçŸ¥è¯†ç‚¹</p>
                    <button id="startBonus" class="inline-flex items-center justify-center px-8 py-4 border border-transparent text-lg font-medium rounded-md shadow-sm text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-all duration-300 transform hover:scale-[1.02]">
                        <i class="fa fa-star mr-2"></i> å¼€å§‹æŒ‘æˆ˜
                    </button>
                </div>
            </div>

            <!-- é™„åŠ é¢˜åŒºåŸŸ (é»˜è®¤éšè—) -->
            <div id="bonusArea" class="hidden max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-neutral">é™„åŠ é¢˜æŒ‘æˆ˜</h3>
                        <div class="flex items-center">
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-600">
                                <i class="fa fa-star mr-1"></i> æŒ‘æˆ˜é¢˜
                            </span>
                        </div>
                    </div>

                    <div id="bonusQuestionContainer" class="mb-8">
                        <!-- é™„åŠ é¢˜å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div id="bonusAnswerFeedback" class="mb-6 hidden">
                        <div id="bonusCorrectFeedback" class="hidden bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded relative">
                            <strong class="font-bold">æ­å–œä½ ç­”å¯¹äº†!</strong>
                            <span class="block sm:inline" id="bonusCorrectAnswerText"></span>
                        </div>
                        <div id="bonusIncorrectFeedback" class="hidden bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative">
                            <strong class="font-bold">ç­”æ¡ˆä¸æ­£ç¡®!</strong>
                            <span class="block sm:inline" id="bonusIncorrectAnswerText"></span>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button id="bonusBack" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                            <i class="fa fa-arrow-left mr-1"></i> è¿”å›
                        </button>
                        <button id="nextBonus" class="px-4 py-2 border border-transparent rounded-md text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                            ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç»Ÿè®¡éƒ¨åˆ† -->
        <section id="stats" class="mb-20 scroll-mt-24">
            <div class="text-center mb-12">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-4">
                    <i class="fa fa-bar-chart text-primary mr-2"></i> å­¦ä¹ ç»Ÿè®¡
                </h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    æŸ¥çœ‹ä½ çš„å­¦ä¹ è¿›åº¦å’Œæˆç»©ç»Ÿè®¡ï¼Œæ¿€åŠ±è‡ªå·±ä¸æ–­è¿›æ­¥
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
                <!-- å­¦ä¹ è¿›åº¦å¡ç‰‡ -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-neutral mb-4">å­¦ä¹ è¿›åº¦</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">çŸ¥è¯†å­¦ä¹ </span>
                                <span id="knowledgeProgressText">0/0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full progress-animation" id="knowledgeProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">ç»ƒä¹ å®Œæˆ</span>
                                <span id="practiceProgressText">0/0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-secondary h-2.5 rounded-full progress-animation" id="practiceProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">æµ‹è¯•å®Œæˆç‡</span>
                                <span id="testProgressText">0/0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-accent h-2.5 rounded-full progress-animation" id="testProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æµ‹è¯•æˆç»©å¡ç‰‡ -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-neutral mb-4">æµ‹è¯•æˆç»©</h3>
                    <div id="scoreChart" class="h-64">
                        <!-- Chart.js å›¾è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- å­¦ä¹ å»ºè®® -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold text-neutral mb-4">å­¦ä¹ å»ºè®®</h3>
                <div id="learningTips" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- å­¦ä¹ å»ºè®®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-neutral text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">å°å­¦æ•°å­¦å­¦ä¹ åŠ©æ‰‹</h3>
                    <p class="text-gray-400 mb-4">
                        å¸®åŠ©å°å­¦ç”Ÿè½»æ¾æŒæ¡æ•°å­¦çŸ¥è¯†ï¼Œæé«˜å­¦ä¹ æ•ˆç‡å’Œæˆç»©
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-youtube"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">å­¦ä¹ èµ„æº</h4>
                    <ul class="space-y-2">
                        <li><a href="#knowledge" class="text-gray-400 hover:text-white transition-colors">çŸ¥è¯†å­¦ä¹ </a></li>
                        <li><a href="#practice" class="text-gray-400 hover:text-white transition-colors">ç»ƒä¹ é¢˜åº“</a></li>
                        <li><a href="#test" class="text-gray-400 hover:text-white transition-colors">çŸ¥è¯†æµ‹è¯•</a></li>
                        <li><a href="#stats" class="text-gray-400 hover:text-white transition-colors">å­¦ä¹ ç»Ÿè®¡</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">å…³äºæˆ‘ä»¬</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">ä½¿ç”¨æŒ‡å—</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">å¸¸è§é—®é¢˜</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">è”ç³»æˆ‘ä»¬</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">éšç§æ”¿ç­–</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">è®¢é˜…æ›´æ–°</h4>
                    <p class="text-gray-400 mb-4">
                        è·å–æœ€æ–°å­¦ä¹ èµ„æ–™å’Œæ•™è‚²èµ„è®¯
                    </p>
                    <form class="space-y-2">
                        <div>
                            <input type="email" placeholder="è¾“å…¥ä½ çš„é‚®ç®±" class="w-full px-4 py-2 rounded-md bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <button type="submit" class="w-full px-4 py-2 bg-primary hover:bg-primary/90 rounded-md text-white font-medium transition-colors">
                            è®¢é˜…
                        </button>
                    </form>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2025 å°å­¦æ•°å­¦å­¦ä¹ åŠ©æ‰‹. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            </div>
        </div>
    </footer>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button id="backToTop" class="fixed bottom-6 right-6 bg-primary text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
        <i class="fa fa-arrow-up"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="knowledge.js"></script>
    <script src="practice.js"></script>
    <script src="bonus.js"></script>
    <script>
        // æ•°å­¦å­¦ä¹ æ•°æ®
        const mathData = {
            knowledge: window.knowledge,
            practice: window.practice,
            // é™„åŠ é¢˜åº“ - ç»¼åˆæ€§éš¾é¢˜ï¼Œæ¶µç›–å¤šä¸ªçŸ¥è¯†ç‚¹
            bonus: window.bonus,
        };

        // å®šä¹‰çŸ¥è¯†æ•°æ®
        const knowledgeData = mathData.knowledge;
        
        // å°†æ–°çš„practiceæ•°æ®ç»“æ„è½¬æ¢ä¸ºæ‰å¹³æ•°ç»„ä»¥å…¼å®¹ç°æœ‰ä»£ç 
        const practiceData = [];
        Object.keys(mathData.practice).forEach(category => {
            Object.keys(mathData.practice[category]).forEach(difficulty => {
                practiceData.push(...mathData.practice[category][difficulty]);
            });
        });
        
        // éš¾åº¦é¢œè‰²æ˜ å°„
        const difficultyColors = {
            'åŸºç¡€': 'bg-green-100 text-green-700',
            'æé«˜': 'bg-yellow-100 text-yellow-700', 
            'å›°éš¾': 'bg-red-100 text-red-700'
        };

        // å…¨å±€å˜é‡
        let currentKnowledgeFilter = 'all';
        let currentPracticeFilter = 'all';
        let currentTest = null;
        let currentQuestionIndex = 0;
        let testAnswers = [];
        let testStartTime = null;
        let scoreChart = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        // ç§»é™¤é‡å¤çš„åˆå§‹åŒ–è°ƒç”¨ï¼Œç»Ÿä¸€åœ¨initializePageä¸­å¤„ç†

        // åˆå§‹åŒ–çŸ¥è¯†å¡ç‰‡
        function initKnowledgeCards() {
            const container = document.getElementById('knowledgeCards');
            renderKnowledgeCards(knowledgeData);

            // ç­›é€‰æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.knowledge-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.knowledge-filter-btn').forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('bg-gray-100', 'text-gray-700');
                    });
                    this.classList.remove('bg-gray-100', 'text-gray-700');
                    this.classList.add('bg-primary', 'text-white');

                    // ç­›é€‰æ•°æ®
                    currentKnowledgeFilter = this.dataset.filter;
                    const filteredData = filterKnowledgeData(knowledgeData, currentKnowledgeFilter);
                    renderKnowledgeCards(filteredData);
                });
            });

            // éšæœºæ’åº
            document.getElementById('knowledgeShuffle').addEventListener('click', function() {
                const filteredData = filterKnowledgeData(knowledgeData, currentKnowledgeFilter);
                const shuffledData = [...filteredData].sort(() => Math.random() - 0.5);
                renderKnowledgeCards(shuffledData);
            });

            // é‡ç½®
            document.getElementById('knowledgeReset').addEventListener('click', function() {
                currentKnowledgeFilter = 'all';
                document.querySelectorAll('.knowledge-filter-btn').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-gray-100', 'text-gray-700');
                });
                document.querySelector('[data-filter="all"]').classList.remove('bg-gray-100', 'text-gray-700');
                document.querySelector('[data-filter="all"]').classList.add('bg-primary', 'text-white');
                renderKnowledgeCards(knowledgeData);
            });
        }

        // æ¸²æŸ“çŸ¥è¯†å¡ç‰‡
        function renderKnowledgeCards(data) {
            const container = document.getElementById('knowledgeCards');
            container.innerHTML = '';

            data.forEach((item, index) => {
                const cardId = `knowledge-card-${index}`;
                const isLearned = getLearnedStatus(item.title);
                
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-[1.02] relative';
                card.style.minHeight = '280px';
                card.innerHTML = `
                    <div class="card-main p-6" id="${cardId}-main">
                        <div class="flex items-center justify-between mb-3">
                            <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full">${item.chapter}</span>
                            <div class="flex items-center gap-2">
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${item.volume}</span>
                                <button class="learn-status-btn ${isLearned ? 'text-green-600' : 'text-gray-400'} hover:text-green-600 transition-colors" 
                                        data-title="${item.title}" title="${isLearned ? 'å·²æŒæ¡' : 'æ ‡è®°ä¸ºå·²æŒæ¡'}">
                                    <i class="fa ${isLearned ? 'fa-check-circle' : 'fa-circle-o'} text-lg"></i>
                                </button>
                            </div>
                        </div>
                        <h3 class="text-lg font-semibold text-neutral mb-3 line-clamp-2">${item.title}</h3>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${item.content}</p>
                        <div class="flex items-center justify-between mt-auto">
                            <span class="text-xs text-gray-500">${item.category}</span>
                            <button class="show-details-btn px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm font-medium transition-colors" 
                                    data-card-id="${cardId}">
                                <i class="fa fa-book mr-1"></i> å…¬å¼å’ŒèŒƒä¾‹
                            </button>
                        </div>
                    </div>
                    <div class="card-details p-6 bg-gradient-to-br from-primary/5 to-secondary/5 hidden" id="${cardId}-details">
                        <div class="h-full flex flex-col">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-neutral">å…¬å¼ä¸ç¤ºä¾‹</h4>
                                <button class="back-btn px-3 py-1 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm transition-colors" 
                                        data-card-id="${cardId}">
                                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›
                                </button>
                            </div>
                            <div class="space-y-4 flex-1">
                                <div class="bg-white rounded-lg p-4">
                                    <div class="text-sm font-medium text-gray-700 mb-2">ğŸ“ å…¬å¼</div>
                                    <div class="math-formula text-primary font-medium text-lg">${item.formula}</div>
                                </div>
                                <div class="bg-white rounded-lg p-4">
                                    <div class="text-sm font-medium text-gray-700 mb-2">ğŸ’¡ ç¤ºä¾‹</div>
                                    <div class="text-sm text-gray-700 whitespace-pre-line leading-relaxed">${item.example}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const showDetailsBtn = card.querySelector('.show-details-btn');
                const backBtn = card.querySelector('.back-btn');
                const learnStatusBtn = card.querySelector('.learn-status-btn');
                const mainDiv = card.querySelector(`#${cardId}-main`);
                const detailsDiv = card.querySelector(`#${cardId}-details`);

                // æ˜¾ç¤ºè¯¦æƒ…
                showDetailsBtn.addEventListener('click', function() {
                    mainDiv.classList.add('hidden');
                    detailsDiv.classList.remove('hidden');
                });

                // è¿”å›ä¸»è§†å›¾
                backBtn.addEventListener('click', function() {
                    detailsDiv.classList.add('hidden');
                    mainDiv.classList.remove('hidden');
                });

                // æ ‡è®°å­¦ä¹ çŠ¶æ€
                learnStatusBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const title = this.dataset.title;
                    const currentStatus = getLearnedStatus(title);
                    setLearnedStatus(title, !currentStatus);
                    
                    if (!currentStatus) {
                        this.innerHTML = '<i class="fa fa-check-circle text-lg"></i>';
                        this.className = 'learn-status-btn text-green-600 hover:text-green-600 transition-colors';
                        this.title = 'å·²æŒæ¡';
                        
                        // æ·»åŠ æˆåŠŸåŠ¨ç”»
                        this.style.transform = 'scale(1.2)';
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                        }, 200);
                    } else {
                        this.innerHTML = '<i class="fa fa-circle-o text-lg"></i>';
                        this.className = 'learn-status-btn text-gray-400 hover:text-green-600 transition-colors';
                        this.title = 'æ ‡è®°ä¸ºå·²æŒæ¡';
                    }
                });

                container.appendChild(card);
            });
        }

        // ç­›é€‰çŸ¥è¯†æ•°æ®
        function filterKnowledgeData(data, filter) {
            if (filter === 'all') return data;
            return data.filter(item => {
                return item.volume.includes(filter) || item.category.includes(filter);
            });
        }

        // åˆå§‹åŒ–ç»ƒä¹ å¡ç‰‡
        function initPracticeCards() {
            renderPracticeCards(practiceData);

            // ç­›é€‰æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.practice-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.practice-filter-btn').forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                        b.classList.add('bg-gray-100', 'text-gray-700');
                    });
                    this.classList.remove('bg-gray-100', 'text-gray-700');
                    this.classList.add('bg-primary', 'text-white');

                    // ç­›é€‰æ•°æ®
                    currentPracticeFilter = this.dataset.filter;
                    const filteredData = filterPracticeData(practiceData, currentPracticeFilter);
                    renderPracticeCards(filteredData);
                });
            });

            // éšæœºæ’åº
            document.getElementById('practiceShuffle').addEventListener('click', function() {
                const filteredData = filterPracticeData(practiceData, currentPracticeFilter);
                const shuffledData = [...filteredData].sort(() => Math.random() - 0.5);
                renderPracticeCards(shuffledData);
            });

            // é‡ç½®
            document.getElementById('practiceReset').addEventListener('click', function() {
                currentPracticeFilter = 'all';
                document.querySelectorAll('.practice-filter-btn').forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-gray-100', 'text-gray-700');
                });
                document.querySelector('.practice-filter-btn[data-filter="all"]').classList.remove('bg-gray-100', 'text-gray-700');
                document.querySelector('.practice-filter-btn[data-filter="all"]').classList.add('bg-primary', 'text-white');
                renderPracticeCards(practiceData);
            });
        }

        // æ¸²æŸ“ç»ƒä¹ å¡ç‰‡
        function renderPracticeCards(data) {
            const container = document.getElementById('practiceCards');
            container.innerHTML = '';

            data.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-[1.02] p-6';
                
                const optionsHtml = item.type === 'choice' ? 
                    `<div class="mt-4">
                        <div class="text-sm font-medium text-gray-700 mb-2">é€‰æ‹©ç­”æ¡ˆï¼š</div>
                        <div class="grid grid-cols-2 gap-2">
                            ${item.options.map((option, i) => 
                                `<button class="practice-option px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 text-left" data-answer="${option}">${String.fromCharCode(65 + i)}. ${option}</button>`
                            ).join('')}
                        </div>
                    </div>` : 
                    `<div class="mt-4">
                        <div class="text-sm font-medium text-gray-700 mb-2">å¡«å†™ç­”æ¡ˆï¼š</div>
                        <input type="text" class="practice-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ">
                    </div>`;

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <span class="px-3 py-1 bg-secondary/10 text-secondary text-xs font-medium rounded-full">${item.chapter}</span>
                        <div class="flex gap-2">
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${item.volume}</span>
                            <span class="px-2 py-1 text-xs rounded ${difficultyColors[item.difficulty] || 'bg-blue-100 text-blue-600'}">${item.difficulty}</span>
                        </div>
                    </div>
                    <h3 class="text-lg font-semibold text-neutral mb-3">${item.question}</h3>
                    ${optionsHtml}
                    <div class="mt-4 flex justify-between items-center">
                        <button class="practice-check-btn px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm font-medium">æ£€æŸ¥ç­”æ¡ˆ</button>
                        <span class="text-xs text-gray-500">${item.category}</span>
                    </div>
                    <div class="practice-result mt-4 hidden">
                        <div class="p-3 rounded-lg">
                            <div class="practice-feedback font-medium mb-2"></div>
                            <div class="practice-explanation text-sm text-gray-600"></div>
                        </div>
                    </div>
                `;

                // æ·»åŠ ç»ƒä¹ é¢˜äº¤äº’
                const checkBtn = card.querySelector('.practice-check-btn');
                const resultDiv = card.querySelector('.practice-result');
                const feedbackDiv = card.querySelector('.practice-feedback');
                const explanationDiv = card.querySelector('.practice-explanation');

                checkBtn.addEventListener('click', function() {
                    let userAnswer = '';
                    if (item.type === 'choice') {
                        const selectedOption = card.querySelector('.practice-option.selected');
                        userAnswer = selectedOption ? selectedOption.dataset.answer : '';
                    } else {
                        userAnswer = card.querySelector('.practice-input').value.trim();
                    }

                    if (!userAnswer) {
                        alert('è¯·å…ˆé€‰æ‹©æˆ–å¡«å†™ç­”æ¡ˆï¼');
                        return;
                    }

                    const isCorrect = checkMathAnswer(userAnswer, item.answer);
                    
                    resultDiv.classList.remove('hidden');
                    if (isCorrect) {
                        resultDiv.className = 'practice-result mt-4 bg-green-50 border border-green-200';
                        feedbackDiv.className = 'practice-feedback font-medium mb-2 text-green-700';
                        feedbackDiv.textContent = 'âœ… ç­”æ¡ˆæ­£ç¡®ï¼';
                    } else {
                        resultDiv.className = 'practice-result mt-4 bg-red-50 border border-red-200';
                        feedbackDiv.className = 'practice-feedback font-medium mb-2 text-red-700';
                        feedbackDiv.textContent = `âŒ ç­”æ¡ˆé”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${item.answer}`;
                    }
                    explanationDiv.textContent = item.explanation;
                    
                    checkBtn.textContent = 'é‡æ–°ç»ƒä¹ ';
                    checkBtn.onclick = () => location.reload();
                });

                // é€‰æ‹©é¢˜é€‰é¡¹ç‚¹å‡»äº‹ä»¶
                if (item.type === 'choice') {
                    card.querySelectorAll('.practice-option').forEach(option => {
                        option.addEventListener('click', function() {
                            card.querySelectorAll('.practice-option').forEach(opt => {
                                opt.classList.remove('selected', 'bg-primary', 'text-white');
                                opt.classList.add('hover:bg-gray-50');
                            });
                            this.classList.add('selected', 'bg-primary', 'text-white');
                            this.classList.remove('hover:bg-gray-50');
                        });
                    });
                }

                container.appendChild(card);
            });
        }

        // ç­›é€‰ç»ƒä¹ æ•°æ®
        function filterPracticeData(data, filter) {
            if (filter === 'all') return practiceData;
            return practiceData.filter(item => {
                return item.volume.includes(filter) || item.difficulty.includes(filter);
            });
        }

        // æ£€æŸ¥æ•°å­¦ç­”æ¡ˆ
        function checkMathAnswer(userAnswer, correctAnswer) {
            // æ ‡å‡†åŒ–ç­”æ¡ˆæ ¼å¼
            const normalizeAnswer = (answer) => {
                return answer.toString().toLowerCase().replace(/\s+/g, '').replace(/[ï¼Œ,]/g, 'ã€');
            };
            
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(correctAnswer);
            
            // ç›´æ¥åŒ¹é…
            if (normalizedUser === normalizedCorrect) return true;
            
            // æ•°å€¼åŒ¹é…ï¼ˆå¤„ç†å°æ•°ã€åˆ†æ•°ç­‰ï¼‰
            try {
                const userNum = parseFloat(userAnswer);
                const correctNum = parseFloat(correctAnswer);
                if (!isNaN(userNum) && !isNaN(correctNum)) {
                    return Math.abs(userNum - correctNum) < 0.001;
                }
            } catch (e) {}
            
            // åŒ…å«åŒ¹é…ï¼ˆç”¨äºå¤šä¸ªç­”æ¡ˆçš„æƒ…å†µï¼‰
            if (normalizedCorrect.includes('ã€')) {
                const correctAnswers = normalizedCorrect.split('ã€');
                return correctAnswers.some(ans => normalizedUser.includes(ans.trim()));
            }
            
            return false;
        }

        // åˆå§‹åŒ–æµ‹è¯•åŠŸèƒ½
        function initTestFunctionality() {
            const startTestBtn = document.getElementById('startTest');
            const testArea = document.getElementById('testArea');
            const testResults = document.getElementById('testResults');
            const testSetup = testArea.previousElementSibling;

            startTestBtn.addEventListener('click', function() {
                const testType = document.getElementById('testType').value;
                const questionCount = parseInt(document.getElementById('questionCount').value);
                
                // ç”Ÿæˆæµ‹è¯•é¢˜ç›®
                currentTest = generateTest(testType, questionCount);
                currentQuestionIndex = 0;
                testAnswers = new Array(currentTest.questions.length).fill(null);
                testStartTime = new Date();
                
                // æ˜¾ç¤ºæµ‹è¯•åŒºåŸŸ
                testSetup.classList.add('hidden');
                testArea.classList.remove('hidden');
                testResults.classList.add('hidden');
                
                // æ˜¾ç¤ºç¬¬ä¸€é¢˜
                showQuestion(0);
                updateTestProgress();
            });

            // ä¸Šä¸€é¢˜æŒ‰é’®
            document.getElementById('prevQuestion').addEventListener('click', function() {
                if (currentQuestionIndex > 0) {
                    saveCurrentAnswer();
                    currentQuestionIndex--;
                    showQuestion(currentQuestionIndex);
                    updateTestProgress();
                }
            });

            // ä¸‹ä¸€é¢˜æŒ‰é’®
            document.getElementById('nextQuestion').addEventListener('click', function() {
                saveCurrentAnswer();
                if (currentQuestionIndex < currentTest.questions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                    updateTestProgress();
                } else {
                    finishTest();
                }
            });

            // å†æµ‹ä¸€æ¬¡æŒ‰é’®
            document.getElementById('retakeTest').addEventListener('click', function() {
                testResults.classList.add('hidden');
                testSetup.classList.remove('hidden');
                testArea.classList.add('hidden');
            });

            // æŸ¥çœ‹é”™é¢˜æŒ‰é’®
            document.getElementById('reviewAnswers').addEventListener('click', function() {
                showWrongAnswersReview();
            });

            // å…³é—­é”™é¢˜å›é¡¾
            document.getElementById('closeReview').addEventListener('click', function() {
                document.getElementById('wrongAnswersReview').classList.add('hidden');
            });
        }

        // ç”Ÿæˆæµ‹è¯•
        function generateTest(testType, questionCount) {
            let selectedQuestions = [];
            
            if (testType === 'mixed') {
                // æ··åˆæ¨¡å¼ï¼šæ¯ä¸ªç±»å‹æ¯ä¸ªéš¾åº¦éƒ½å‡ºä¸€é“é¢˜
                const categories = ['è®¡ç®—', 'åº”ç”¨', 'å‡ ä½•'];
                const difficulties = ['åŸºç¡€', 'æé«˜', 'å›°éš¾'];
                
                categories.forEach(category => {
                    difficulties.forEach(difficulty => {
                        const questions = mathData.practice[category][difficulty];
                        if (questions && questions.length > 0) {
                            // éšæœºé€‰æ‹©ä¸€é“é¢˜
                            const randomIndex = Math.floor(Math.random() * questions.length);
                            selectedQuestions.push(questions[randomIndex]);
                        }
                    });
                });
                
                // æ‰“ä¹±é¢˜ç›®é¡ºåº
                selectedQuestions = selectedQuestions.sort(() => Math.random() - 0.5);
            } else {
                // æŒ‡å®šç±»å‹æ¨¡å¼ï¼šä»è¯¥ç±»å‹çš„æ‰€æœ‰éš¾åº¦ä¸­éšæœºé€‰æ‹©
                const typeMap = {
                    'calculation': 'è®¡ç®—',
                    'application': 'åº”ç”¨',
                    'geometry': 'å‡ ä½•'
                };
                
                const category = typeMap[testType];
                if (category && mathData.practice[category]) {
                    const difficulties = ['åŸºç¡€', 'æé«˜', 'å›°éš¾'];
                    const availableQuestions = [];
                    
                    difficulties.forEach(difficulty => {
                        const questions = mathData.practice[category][difficulty];
                        if (questions && questions.length > 0) {
                            availableQuestions.push(...questions);
                        }
                    });
                    
                    // éšæœºé€‰æ‹©æŒ‡å®šæ•°é‡çš„é¢˜ç›®
                    const shuffled = availableQuestions.sort(() => Math.random() - 0.5);
                    selectedQuestions = shuffled.slice(0, Math.min(questionCount, shuffled.length));
                }
            }
            
            return {
                type: testType,
                questions: selectedQuestions,
                startTime: new Date()
            };
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion(index) {
            const question = currentTest.questions[index];
            const container = document.getElementById('questionContainer');
            
            const optionsHtml = question.type === 'choice' ? 
                `<div class="mt-6">
                    <div class="text-sm font-medium text-gray-700 mb-3">è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼š</div>
                    <div class="space-y-2">
                        ${question.options.map((option, i) => 
                            `<label class="flex items-center p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="testAnswer" value="${option}" class="mr-3 text-primary focus:ring-primary">
                                <span>${String.fromCharCode(65 + i)}. ${option}</span>
                            </label>`
                        ).join('')}
                    </div>
                </div>` : 
                `<div class="mt-6">
                    <div class="text-sm font-medium text-gray-700 mb-3">è¯·å¡«å†™ç­”æ¡ˆï¼š</div>
                    <input type="text" id="testAnswerInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-lg" placeholder="è¯·è¾“å…¥ä½ çš„ç­”æ¡ˆ">
                </div>`;

            container.innerHTML = `
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-500">ç¬¬ ${index + 1} é¢˜</span>
                        <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full">${question.chapter}</span>
                    </div>
                    <h3 class="text-xl font-semibold text-neutral mb-2">${question.question}</h3>
                    <div class="flex gap-2">
                        <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${question.category}</span>
                        <span class="px-2 py-1 text-xs rounded ${difficultyColors[question.difficulty] || 'bg-blue-100 text-blue-600'}">${question.difficulty}</span>
                    </div>
                </div>
                ${optionsHtml}
            `;
            
            // æ¢å¤ä¹‹å‰çš„ç­”æ¡ˆ
            if (testAnswers[index]) {
                if (question.type === 'choice') {
                    const radio = container.querySelector(`input[value="${testAnswers[index]}"]`);
                    if (radio) radio.checked = true;
                } else {
                    const input = container.querySelector('#testAnswerInput');
                    if (input) input.value = testAnswers[index];
                }
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('prevQuestion').disabled = index === 0;
            const nextBtn = document.getElementById('nextQuestion');
            if (index === currentTest.questions.length - 1) {
                nextBtn.innerHTML = 'å®Œæˆæµ‹è¯• <i class="fa fa-check ml-1"></i>';
            } else {
                nextBtn.innerHTML = 'ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right ml-1"></i>';
            }
        }

        // ä¿å­˜å½“å‰ç­”æ¡ˆ
        function saveCurrentAnswer() {
            const question = currentTest.questions[currentQuestionIndex];
            let answer = '';
            
            if (question.type === 'choice') {
                const selected = document.querySelector('input[name="testAnswer"]:checked');
                answer = selected ? selected.value : '';
            } else {
                const input = document.getElementById('testAnswerInput');
                answer = input ? input.value.trim() : '';
            }
            
            testAnswers[currentQuestionIndex] = answer;
        }

        // æ›´æ–°æµ‹è¯•è¿›åº¦
        function updateTestProgress() {
            const progress = ((currentQuestionIndex + 1) / currentTest.questions.length) * 100;
            document.getElementById('testProgressBar').style.width = progress + '%';
            document.getElementById('testProgressText').textContent = `${currentQuestionIndex + 1}/${currentTest.questions.length}`;
        }

        // å®Œæˆæµ‹è¯•
        function finishTest() {
            saveCurrentAnswer();
            
            // è®¡ç®—å¾—åˆ†
            let correctCount = 0;
            const detailedResults = [];
            
            currentTest.questions.forEach((question, index) => {
                const userAnswer = testAnswers[index] || '';
                const isCorrect = checkMathAnswer(userAnswer, question.answer);
                if (isCorrect) correctCount++;
                
                detailedResults.push({
                    question: question.question,
                    userAnswer: userAnswer,
                    correctAnswer: question.answer,
                    isCorrect: isCorrect,
                    explanation: generateExplanation(question, userAnswer, isCorrect)
                });
            });
            
            const score = correctCount;
            const total = currentTest.questions.length;
            const percentage = Math.round((score / total) * 100);
            
            // ä¿å­˜æµ‹è¯•ç»“æœ
            saveTestResult({
                score: score,
                total: total,
                percentage: percentage,
                testType: currentTest.type,
                date: new Date().toISOString(),
                duration: Math.round((new Date() - testStartTime) / 1000),
                details: detailedResults
            });
            
            // æ˜¾ç¤ºç»“æœ
            showTestResults(score, total, percentage, detailedResults);
        }

        // ç”Ÿæˆè§£æ
        function generateExplanation(question, userAnswer, isCorrect) {
            if (isCorrect) {
                return `ğŸ‰ ç­”æ¡ˆæ­£ç¡®ï¼${question.explanation}`;
            } else {
                return `ğŸ“š ${question.explanation}`;
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResults(score, total, percentage, details) {
            document.getElementById('testArea').classList.add('hidden');
            document.getElementById('testResults').classList.remove('hidden');
            
            // æ›´æ–°å¾—åˆ†æ˜¾ç¤º
            document.getElementById('finalScore').textContent = `${score}/${total}`;
            
            // æ›´æ–°å›¾æ ‡å’Œé¢œè‰²
            const resultIcon = document.querySelector('#testResults .fa-trophy').parentElement;
            if (percentage >= 80) {
                resultIcon.className = 'inline-flex items-center justify-center w-24 h-24 rounded-full bg-green-100 text-green-600 mb-4';
                resultIcon.innerHTML = '<i class="fa fa-trophy text-4xl"></i>';
            } else if (percentage >= 60) {
                resultIcon.className = 'inline-flex items-center justify-center w-24 h-24 rounded-full bg-yellow-100 text-yellow-600 mb-4';
                resultIcon.innerHTML = '<i class="fa fa-star text-4xl"></i>';
            } else {
                resultIcon.className = 'inline-flex items-center justify-center w-24 h-24 rounded-full bg-red-100 text-red-600 mb-4';
                resultIcon.innerHTML = '<i class="fa fa-refresh text-4xl"></i>';
            }
            
            // æ˜¾ç¤ºå†å²å¾—åˆ†
            updateScoreHistory();
            
            // ä¿å­˜é”™é¢˜è®°å½•
            const wrongAnswers = details.filter(d => !d.isCorrect);
            if (wrongAnswers.length > 0) {
                localStorage.setItem('mathWrongAnswers', JSON.stringify(wrongAnswers));
                document.getElementById('reviewAnswers').classList.remove('hidden');
            } else {
                document.getElementById('reviewAnswers').classList.add('hidden');
            }
        }

        // æ˜¾ç¤ºé”™é¢˜å›é¡¾
        function showWrongAnswersReview() {
            const wrongAnswers = JSON.parse(localStorage.getItem('mathWrongAnswers') || '[]');
            const reviewDiv = document.getElementById('wrongAnswersReview');
            const listDiv = document.getElementById('wrongAnswersList');
            
            if (wrongAnswers.length === 0) {
                listDiv.innerHTML = '<div class="text-center py-8 text-gray-500">ğŸ‰ å¤ªæ£’äº†ï¼æ²¡æœ‰é”™é¢˜éœ€è¦å›é¡¾ã€‚</div>';
            } else {
                listDiv.innerHTML = wrongAnswers.map((item, index) => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-start justify-between mb-2">
                            <h5 class="font-medium text-neutral">ç¬¬ ${index + 1} é¢˜</h5>
                            <span class="px-2 py-1 bg-red-100 text-red-600 text-xs rounded">é”™è¯¯</span>
                        </div>
                        <div class="mb-3">
                            <div class="text-sm text-gray-600 mb-1">é¢˜ç›®ï¼š</div>
                            <div class="text-gray-800">${item.question}</div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <div>
                                <div class="text-sm text-gray-600 mb-1">ä½ çš„ç­”æ¡ˆï¼š</div>
                                <div class="text-red-600 font-medium">${item.userAnswer || 'æœªä½œç­”'}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600 mb-1">æ­£ç¡®ç­”æ¡ˆï¼š</div>
                                <div class="text-green-600 font-medium">${item.correctAnswer}</div>
                            </div>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded p-3">
                            <div class="text-sm text-blue-800">${item.explanation}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            reviewDiv.classList.remove('hidden');
        }

        // ä¿å­˜æµ‹è¯•ç»“æœ
        function saveTestResult(result) {
            const results = JSON.parse(localStorage.getItem('mathTestResults') || '[]');
            results.push(result);
            // åªä¿ç•™æœ€è¿‘20æ¬¡æµ‹è¯•ç»“æœ
            if (results.length > 20) {
                results.splice(0, results.length - 20);
            }
            localStorage.setItem('mathTestResults', JSON.stringify(results));
        }

        // æ›´æ–°å¾—åˆ†å†å²
        function updateScoreHistory() {
            const results = JSON.parse(localStorage.getItem('mathTestResults') || '[]');
            const historyDiv = document.getElementById('scoreHistory');
            
            if (results.length === 0) {
                historyDiv.innerHTML = '<div class="text-center text-gray-500">æš‚æ— æµ‹è¯•è®°å½•</div>';
                return;
            }
            
            const recent5 = results.slice(-5).reverse();
            historyDiv.innerHTML = recent5.map(result => {
                const date = new Date(result.date).toLocaleDateString();
                const colorClass = result.percentage >= 80 ? 'text-green-600' : 
                                 result.percentage >= 60 ? 'text-yellow-600' : 'text-red-600';
                return `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                        <span class="text-sm text-gray-600">${date}</span>
                        <span class="font-medium ${colorClass}">${result.score}/${result.total}</span>
                    </div>
                `;
            }).join('');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            const results = JSON.parse(localStorage.getItem('mathTestResults') || '[]');
            
            // å®‰å…¨åœ°æ›´æ–°DOMå…ƒç´ 
            const updateElement = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            };
            
            if (results.length === 0) {
                updateElement('totalTests', '0');
                updateElement('averageScore', '0%');
                updateElement('bestScore', '0%');
                updateElement('weakestTopic', 'æš‚æ— æ•°æ®');
                return;
            }
            
            // æ€»æµ‹è¯•æ¬¡æ•°
            updateElement('totalTests', results.length);
            
            // å¹³å‡åˆ†
            const avgPercentage = Math.round(results.reduce((sum, r) => sum + r.percentage, 0) / results.length);
            updateElement('averageScore', avgPercentage + '%');
            
            // æœ€é«˜åˆ†
            const bestPercentage = Math.max(...results.map(r => r.percentage));
            updateElement('bestScore', bestPercentage + '%');
            
            // è–„å¼±çŸ¥è¯†ç‚¹åˆ†æ
            const topicStats = {};
            results.forEach(result => {
                if (result.details) {
                    result.details.forEach(detail => {
                        const topic = detail.question.split('ï¼š')[0] || 'å…¶ä»–';
                        if (!topicStats[topic]) {
                            topicStats[topic] = { correct: 0, total: 0 };
                        }
                        topicStats[topic].total++;
                        if (detail.isCorrect) {
                            topicStats[topic].correct++;
                        }
                    });
                }
            });
            
            let weakestTopic = 'æš‚æ— æ•°æ®';
            let lowestRate = 1;
            for (const [topic, stats] of Object.entries(topicStats)) {
                const rate = stats.correct / stats.total;
                if (rate < lowestRate) {
                    lowestRate = rate;
                    weakestTopic = topic;
                }
            }
            
            updateElement('weakestTopic', weakestTopic);
        }

        // è·å–å­¦ä¹ å»ºè®®
        function getLearningAdvice() {
            const results = JSON.parse(localStorage.getItem('mathTestResults') || '[]');
            
            if (results.length === 0) {
                return 'å¼€å§‹ä½ çš„æ•°å­¦å­¦ä¹ ä¹‹æ—…å§ï¼å»ºè®®å…ˆä»åŸºç¡€çŸ¥è¯†ç‚¹å¼€å§‹å­¦ä¹ ã€‚';
            }
            
            const recent = results.slice(-3);
            const avgRecent = recent.reduce((sum, r) => sum + r.percentage, 0) / recent.length;
            
            if (avgRecent >= 90) {
                return 'ğŸŒŸ ä¼˜ç§€ï¼ä½ çš„æ•°å­¦åŸºç¡€éå¸¸æ‰å®ï¼Œå»ºè®®æŒ‘æˆ˜æ›´é«˜éš¾åº¦çš„é¢˜ç›®ï¼Œæˆ–è€…å¸®åŠ©åŒå­¦ä¸€èµ·å­¦ä¹ ã€‚';
            } else if (avgRecent >= 80) {
                return 'ğŸ‘ å¾ˆå¥½ï¼ç»§ç»­ä¿æŒï¼Œå»ºè®®é‡ç‚¹å¤ä¹ é”™é¢˜ï¼Œå·©å›ºè–„å¼±ç¯èŠ‚ã€‚';
            } else if (avgRecent >= 60) {
                return 'ğŸ“š è¿˜éœ€åŠªåŠ›ï¼å»ºè®®å›é¡¾åŸºç¡€çŸ¥è¯†ç‚¹ï¼Œå¤šåšç»ƒä¹ é¢˜ï¼Œç‰¹åˆ«å…³æ³¨è®¡ç®—å‡†ç¡®æ€§ã€‚';
            } else {
                return 'ğŸ’ª åŠ æ²¹ï¼å»ºè®®ä»åŸºç¡€æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥å»ºç«‹çŸ¥è¯†ä½“ç³»ï¼Œä¸è¦æ€¥äºæ±‚æˆã€‚';
            }
        }

        // å­¦ä¹ çŠ¶æ€ç®¡ç†å‡½æ•°
        function getLearnedStatus(title) {
            const learnedItems = JSON.parse(localStorage.getItem('learnedKnowledge') || '[]');
            return learnedItems.includes(title);
        }

        function setLearnedStatus(title, isLearned) {
            let learnedItems = JSON.parse(localStorage.getItem('learnedKnowledge') || '[]');
            
            if (isLearned && !learnedItems.includes(title)) {
                learnedItems.push(title);
            } else if (!isLearned && learnedItems.includes(title)) {
                learnedItems = learnedItems.filter(item => item !== title);
            }
            
            localStorage.setItem('learnedKnowledge', JSON.stringify(learnedItems));
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateLearningProgress();
        }

        function updateLearningProgress() {
            const learnedItems = JSON.parse(localStorage.getItem('learnedKnowledge') || '[]');
            const totalItems = knowledgeData.length;
            const learnedCount = learnedItems.length;
            const progressPercentage = totalItems > 0 ? Math.round((learnedCount / totalItems) * 100) : 0;
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤ºï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            const progressElement = document.querySelector('.learning-progress');
            if (progressElement) {
                progressElement.textContent = `å­¦ä¹ è¿›åº¦: ${learnedCount}/${totalItems} (${progressPercentage}%)`;
            }
        }

        // åˆå§‹åŒ–é™„åŠ é¢˜åŠŸèƒ½
        function initBonusFunctionality() {
            let currentBonusQuestion = null;
            let bonusQuestionIndex = 0;
            
            const startBonusBtn = document.getElementById('startBonus');
            const bonusArea = document.getElementById('bonusArea');
            const bonusQuestionContainer = document.getElementById('bonusQuestionContainer');
            const bonusAnswerFeedback = document.getElementById('bonusAnswerFeedback');
            const bonusCorrectFeedback = document.getElementById('bonusCorrectFeedback');
            const bonusIncorrectFeedback = document.getElementById('bonusIncorrectFeedback');
            const bonusCorrectAnswerText = document.getElementById('bonusCorrectAnswerText');
            const bonusIncorrectAnswerText = document.getElementById('bonusIncorrectAnswerText');
            const bonusBackBtn = document.getElementById('bonusBack');
            const nextBonusBtn = document.getElementById('nextBonus');
            
            // å¼€å§‹é™„åŠ é¢˜æŒ‘æˆ˜
            startBonusBtn.addEventListener('click', function() {
                startBonusChallenge();
            });
            
            // è¿”å›æŒ‰é’®
            bonusBackBtn.addEventListener('click', function() {
                bonusArea.classList.add('hidden');
                resetBonusQuestion();
            });
            
            // ä¸‹ä¸€é¢˜æŒ‰é’®
            nextBonusBtn.addEventListener('click', function() {
                startBonusChallenge();
            });
            
            function startBonusChallenge() {
                // éšæœºé€‰æ‹©ä¸€é“é™„åŠ é¢˜
                const randomIndex = Math.floor(Math.random() * mathData.bonus.length);
                currentBonusQuestion = mathData.bonus[randomIndex];
                bonusQuestionIndex++;
                
                // æ˜¾ç¤ºé™„åŠ é¢˜åŒºåŸŸ
                bonusArea.classList.remove('hidden');
                
                // æ¸²æŸ“é¢˜ç›®
                renderBonusQuestion(currentBonusQuestion);
                
                // é‡ç½®åé¦ˆ
                resetBonusQuestion();
            }
            
            function renderBonusQuestion(question) {
                let questionHTML = `
                    <div class="mb-6">
                        <div class="flex flex-wrap items-center gap-2 mb-4">
                            <span class="px-2 py-1 bg-blue-100 text-blue-600 rounded text-sm font-medium">
                                ${question.category}
                            </span>
                            <span class="px-2 py-1 bg-purple-100 text-purple-600 rounded text-sm font-medium">
                                ${question.volume}
                            </span>
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-sm font-medium">
                                ${question.chapter}
                            </span>
                            <span class="px-2 py-1 ${difficultyColors[question.difficulty] || 'bg-blue-100 text-blue-600'} rounded text-sm font-medium">
                                ${question.difficulty}
                            </span>
                        </div>
                        <div class="text-lg font-medium text-neutral mb-4">
                            ${question.question}
                        </div>
                        <div class="mb-4">
                            <span class="text-sm text-gray-500">æ¶‰åŠçŸ¥è¯†ç‚¹ï¼š${question.knowledgePoints.join('ã€')}</span>
                        </div>
                    </div>
                `;
                
                if (question.type === 'choice') {
                    questionHTML += `
                        <div class="space-y-2 mb-6">
                            ${question.options.map((option, index) => `
                                <button class="bonus-option w-full text-left p-3 border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-orange-500" data-value="${String.fromCharCode(65 + index)}">
                                    <span class="font-medium">${String.fromCharCode(65 + index)}.</span> ${option}
                                </button>
                            `).join('')}
                        </div>
                    `;
                } else {
                    questionHTML += `
                        <div class="mb-6">
                            <input type="text" id="bonusAnswer" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ">
                        </div>
                    `;
                }
                
                questionHTML += `
                    <button id="checkBonusAnswer" class="w-full px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                        <i class="fa fa-check mr-1"></i> æ£€æŸ¥ç­”æ¡ˆ
                    </button>
                `;
                
                bonusQuestionContainer.innerHTML = questionHTML;
                
                // ç»‘å®šäº‹ä»¶
                bindBonusEvents(question);
            }
            
            function bindBonusEvents(question) {
                const checkBtn = document.getElementById('checkBonusAnswer');
                const optionBtns = document.querySelectorAll('.bonus-option');
                const answerInput = document.getElementById('bonusAnswer');
                
                let selectedAnswer = '';
                
                // é€‰æ‹©é¢˜é€‰é¡¹ç‚¹å‡»äº‹ä»¶
                optionBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        optionBtns.forEach(b => b.classList.remove('bg-orange-100', 'border-orange-500'));
                        this.classList.add('bg-orange-100', 'border-orange-500');
                        selectedAnswer = this.dataset.value;
                    });
                });
                
                // æ£€æŸ¥ç­”æ¡ˆ
                checkBtn.addEventListener('click', function() {
                    let userAnswer = '';
                    
                    if (question.type === 'choice') {
                        userAnswer = selectedAnswer;
                    } else {
                        userAnswer = answerInput.value.trim();
                    }
                    
                    if (!userAnswer) {
                        alert('è¯·å…ˆé€‰æ‹©æˆ–è¾“å…¥ç­”æ¡ˆï¼');
                        return;
                    }
                    
                    checkBonusAnswer(question, userAnswer);
                });
                
                // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
                if (answerInput) {
                    answerInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            checkBtn.click();
                        }
                    });
                }
            }
            
            function checkBonusAnswer(question, userAnswer) {
                const isCorrect = checkMathAnswer(userAnswer, question.answer);
                
                bonusAnswerFeedback.classList.remove('hidden');
                
                if (isCorrect) {
                    bonusCorrectFeedback.classList.remove('hidden');
                    bonusIncorrectFeedback.classList.add('hidden');
                    bonusCorrectAnswerText.textContent = ` è§£æï¼š${question.explanation}`;
                    
                    // ä¿å­˜é™„åŠ é¢˜å®Œæˆè®°å½•
                    saveBonusResult(true);
                } else {
                    bonusIncorrectFeedback.classList.remove('hidden');
                    bonusCorrectFeedback.classList.add('hidden');
                    bonusIncorrectAnswerText.textContent = ` æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${question.answer}ã€‚è§£æï¼š${question.explanation}`;
                    
                    // ä¿å­˜é™„åŠ é¢˜å®Œæˆè®°å½•
                    saveBonusResult(false);
                }
                
                // ç¦ç”¨æ‰€æœ‰è¾“å…¥
                const inputs = bonusQuestionContainer.querySelectorAll('input, button');
                inputs.forEach(input => {
                    if (input.id !== 'checkBonusAnswer') {
                        input.disabled = true;
                    }
                });
                
                // æ›´æ”¹æ£€æŸ¥æŒ‰é’®æ–‡æœ¬
                const checkBtn = document.getElementById('checkBonusAnswer');
                checkBtn.textContent = 'å·²å®Œæˆ';
                checkBtn.disabled = true;
            }
            
            function saveBonusResult(isCorrect) {
                const bonusResults = JSON.parse(localStorage.getItem('bonusResults') || '[]');
                bonusResults.push({
                    date: new Date().toISOString(),
                    questionIndex: bonusQuestionIndex,
                    correct: isCorrect,
                    question: currentBonusQuestion.question,
                    answer: currentBonusQuestion.answer
                });
                
                // åªä¿ç•™æœ€è¿‘50æ¬¡è®°å½•
                if (bonusResults.length > 50) {
                    bonusResults.splice(0, bonusResults.length - 50);
                }
                
                localStorage.setItem('bonusResults', JSON.stringify(bonusResults));
            }
            
            function resetBonusQuestion() {
                bonusAnswerFeedback.classList.add('hidden');
                bonusCorrectFeedback.classList.add('hidden');
                bonusIncorrectFeedback.classList.add('hidden');
            }
        }

        // åˆå§‹åŒ–å¯¼èˆªåŠŸèƒ½
        function initNavigation() {
            // æ»šåŠ¨æ•ˆæœ
            const nav = document.getElementById('mainNav');
            window.addEventListener('scroll', function() {
                if (window.scrollY > 10) {
                    nav.classList.add('bg-white/95', 'backdrop-blur-sm');
                    nav.classList.remove('bg-white');
                } else {
                    nav.classList.remove('bg-white/95', 'backdrop-blur-sm');
                    nav.classList.add('bg-white');
                }
            });
            
            // ç§»åŠ¨ç«¯èœå•
            const menuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (menuButton && mobileMenu) {
                menuButton.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                });
                
                // ç‚¹å‡»èœå•é¡¹åå…³é—­èœå•
                const menuItems = mobileMenu.querySelectorAll('a');
                menuItems.forEach(item => {
                    item.addEventListener('click', function() {
                        mobileMenu.classList.add('hidden');
                    });
                });
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            // åˆå§‹åŒ–å¯¼èˆª
            initNavigation();
            
            // åˆå§‹åŒ–çŸ¥è¯†å¡ç‰‡
            initKnowledgeCards();
            
            // åˆå§‹åŒ–ç»ƒä¹ å¡ç‰‡
            initPracticeCards();
            
            // åˆå§‹åŒ–æµ‹è¯•åŠŸèƒ½
            initTestFunctionality();
            
            // åˆå§‹åŒ–é™„åŠ é¢˜åŠŸèƒ½
            initBonusFunctionality();
            
            // åˆå§‹åŒ–ç»Ÿè®¡
            updateStatistics();
            
            // æ›´æ–°å­¦ä¹ è¿›åº¦
            updateLearningProgress();
            
            // æ›´æ–°å­¦ä¹ å»ºè®®
            const adviceElement = document.getElementById('learningAdvice');
            if (adviceElement) {
                adviceElement.textContent = getLearningAdvice();
            }
            
            // è¿”å›é¡¶éƒ¨åŠŸèƒ½
            const backToTopBtn = document.getElementById('backToTop');
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.remove('hidden');
                } else {
                    backToTopBtn.classList.add('hidden');
                }
            });
            
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // ä¸»é¢˜åˆ‡æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark');
                    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                });
                
                // æ¢å¤ä¸»é¢˜è®¾ç½®
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>